<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MMU RideShare - Smart Campus Carpooling</title>
    <script src="https://cdn.tailwindcss.com/3.4.16"></script>
    <script>tailwind.config = { theme: { extend: { colors: { primary: '#007AFF', secondary: '#34C759' }, borderRadius: { 'none': '0px', 'sm': '4px', DEFAULT: '8px', 'md': '12px', 'lg': '16px', 'xl': '20px', '2xl': '24px', '3xl': '32px', 'full': '9999px', 'button': '8px' } } }}</script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Pacifico&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/remixicon/4.6.0/remixicon.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/echarts/5.5.0/echarts.min.js"></script>
    <style>
        :where([class^="ri-"])::before {
            content: "\f3c2";
        }

        body {
            font-family: 'Inter', sans-serif;
            width: 390px;
            margin: 0 auto;
            position: relative;
            min-height: 844px;
            background-color: #F2F2F7;
        }

        .nav-bar {
            position: fixed;
            width: 390px;
            top: 0;
            z-index: 50;
        }

        .tab-bar {
            position: fixed;
            width: 390px;
            bottom: 0;
            z-index: 50;
        }

        .content {
            padding-top: 108px;
            padding-bottom: 70px;
            min-height: 762px;
        }

        .main-content {
            padding: 1rem;
        }

        .sos-button {
            position: fixed;
            right: 1rem;
            bottom: 5rem;
            z-index: 40;
        }

        /* Added overflow handling */
        .truncate-text {
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            max-width: 100%;
        }

        p,
        h1,
        h2,
        h3,
        h4,
        h5,
        h6,
        span,
        div {
            max-width: 100%;
            overflow-wrap: break-word;
            word-wrap: break-word;
        }

        .card-content {
            width: 100%;
            overflow: hidden;
        }

        .message-text {
            overflow-wrap: break-word;
            word-wrap: break-word;
            word-break: break-word;
            hyphens: auto;
            max-width: 100%;
        }

        .chat-bubble {
            max-width: 80%;
            width: auto;
        }

        /* Avatar image fallback */
        .avatar-container {
            position: relative;
            overflow: hidden;
        }
        
        .avatar-container img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .avatar-fallback {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: #007AFF;
            color: white;
            font-weight: 500;
            font-size: 0.85em;
        }

        .avatar-container img[src=""], .avatar-container img:not([src]), .avatar-container img[src="undefined"] {
            opacity: 0;
        }
    </style>
</head>

<body>
    <!-- Login Page -->
    <div id="login-page" class="content flex flex-col items-center justify-center px-6">
        <div class="w-full max-w-sm text-center mb-12">
            <div class="flex items-center justify-center mb-3">
                <i class="ri-car-fill text-primary text-3xl mr-2"></i>
                <h1 class="text-3xl font-['Pacifico'] text-primary">MMU Rides</h1>
            </div>
            <p class="text-gray-600">Smart & Safe Campus Carpooling</p>
        </div>
        <div class="w-full max-w-sm bg-white rounded-lg shadow-sm p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4">Welcome Back</h2>
            <p class="text-sm text-gray-600 mb-6">Sign in with your MMU account to continue</p>
            <button id="mmu-login-btn" onclick="handleMMULogin()"
                class="w-full flex items-center justify-center bg-primary text-white py-3 rounded-button mb-4">
                <i class="ri-account-circle-line mr-2"></i>
                <span id="login-btn-text">Sign in with MMU</span>
                <div id="login-spinner" class="hidden ml-2">
                    <i class="ri-loader-4-line animate-spin"></i>
                </div>
            </button>
            <div id="login-error" class="hidden text-red-500 text-sm text-center mb-4"></div>
            <p class="text-xs text-gray-500 text-center mb-3">For MMU students and staff only</p>
            <div class="flex justify-center">
                <button id="register-btn" class="text-primary text-sm">New user? Register with MMU SSO</button>
            </div>
        </div>
        <div class="w-full max-w-sm space-y-4">
            <div class="bg-gray-100 rounded-lg p-4">
                <div class="flex items-center mb-2">
                    <div class="w-8 h-8 bg-primary bg-opacity-10 rounded-full flex items-center justify-center mr-3">
                        <i class="ri-shield-check-line text-primary"></i>
                    </div>
                    <h3 class="font-medium">Verified Users</h3>
                </div>
                <p class="text-sm text-gray-600">All users are verified MMU members</p>
            </div>
            <div class="bg-gray-100 rounded-lg p-4">
                <div class="flex items-center mb-2">
                    <div class="w-8 h-8 bg-primary bg-opacity-10 rounded-full flex items-center justify-center mr-3">
                        <i class="ri-group-line text-primary"></i>
                    </div>
                    <h3 class="font-medium">Campus Community</h3>
                </div>
                <p class="text-sm text-gray-600">Connect with your campus community</p>
            </div>
        </div>
    </div>

    <!-- Move the modals outside of main app -->
    <!-- MMU Registration Modal (Default Hidden) -->
    <div id="registration-modal" class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-[9999] hidden">
        <div class="bg-white rounded-lg p-5 w-full max-w-sm mx-4">
            <div class="flex justify-between items-center mb-4">
                <div class="flex items-center">
                    <i class="ri-user-add-line text-primary text-xl mr-2"></i>
                    <h3 class="text-lg font-medium">Register with MMU SSO</h3>
                </div>
                <button id="close-registration" class="text-gray-500">
                    <i class="ri-close-line ri-lg"></i>
                </button>
            </div>
            
            <p class="text-sm text-gray-600 mb-4">Please verify your MMU credentials to register. Only current students, staff, and faculty members can create an account.</p>
            
            <form id="registration-form" class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">MMU ID</label>
                    <div class="relative">
                        <input type="text" id="mmu-id" placeholder="e.g., 1191100123" required
                            class="w-full pl-10 pr-4 py-2 rounded-button bg-gray-100 border-none focus:outline-none focus:ring-2 focus:ring-primary">
                        <div class="absolute left-3 top-2 w-5 h-5 flex items-center justify-center">
                            <i class="ri-id-card-line text-gray-500"></i>
                        </div>
                    </div>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">MMU Email</label>
                    <div class="relative">
                        <input type="email" id="mmu-email" placeholder="e.g., 1191100123@student.mmu.edu.my" required
                            class="w-full pl-10 pr-4 py-2 rounded-button bg-gray-100 border-none focus:outline-none focus:ring-2 focus:ring-primary">
                        <div class="absolute left-3 top-2 w-5 h-5 flex items-center justify-center">
                            <i class="ri-mail-line text-gray-500"></i>
                        </div>
                    </div>
                    <p class="text-xs text-gray-500 mt-1">Must be a valid MMU email address</p>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Full Name</label>
                    <div class="relative">
                        <input type="text" id="full-name" placeholder="As in MMU records" required
                            class="w-full pl-10 pr-4 py-2 rounded-button bg-gray-100 border-none focus:outline-none focus:ring-2 focus:ring-primary">
                        <div class="absolute left-3 top-2 w-5 h-5 flex items-center justify-center">
                            <i class="ri-user-line text-gray-500"></i>
                        </div>
                    </div>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Faculty/Department</label>
                    <div class="relative">
                        <select id="faculty" required
                            class="w-full pl-10 pr-4 py-2 rounded-button bg-gray-100 border-none focus:outline-none focus:ring-2 focus:ring-primary appearance-none">
                            <option value="" disabled selected>Select your faculty</option>
                            <option value="fci">Faculty of Computing & Informatics</option>
                            <option value="foe">Faculty of Engineering</option>
                            <option value="fom">Faculty of Management</option>
                            <option value="fbl">Faculty of Business & Law</option>
                            <option value="fcm">Faculty of Creative Multimedia</option>
                            <option value="staff">Staff/Faculty Member</option>
                        </select>
                        <div class="absolute left-3 top-2 w-5 h-5 flex items-center justify-center">
                            <i class="ri-building-line text-gray-500"></i>
                        </div>
                        <div class="absolute right-3 top-2 w-5 h-5 flex items-center justify-center pointer-events-none">
                            <i class="ri-arrow-down-s-line text-gray-500"></i>
                        </div>
                    </div>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Create Password</label>
                    <div class="relative">
                        <input type="password" id="password" placeholder="Minimum 8 characters" required
                            class="w-full pl-10 pr-4 py-2 rounded-button bg-gray-100 border-none focus:outline-none focus:ring-2 focus:ring-primary">
                        <div class="absolute left-3 top-2 w-5 h-5 flex items-center justify-center">
                            <i class="ri-lock-line text-gray-500"></i>
                        </div>
                    </div>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Confirm Password</label>
                    <div class="relative">
                        <input type="password" id="confirm-password" placeholder="Re-enter password" required
                            class="w-full pl-10 pr-4 py-2 rounded-button bg-gray-100 border-none focus:outline-none focus:ring-2 focus:ring-primary">
                        <div class="absolute left-3 top-2 w-5 h-5 flex items-center justify-center">
                            <i class="ri-lock-line text-gray-500"></i>
                        </div>
                    </div>
                </div>
                
                <div class="flex items-start">
                    <div class="flex items-center h-5">
                        <input id="terms" type="checkbox" required
                            class="w-4 h-4 text-primary bg-gray-100 border-none rounded focus:ring-primary">
                    </div>
                    <label for="terms" class="ml-2 text-sm text-gray-600">
                        I agree to the <a href="#" class="text-primary">Terms of Service</a> and <a href="#" class="text-primary">Privacy Policy</a>
                    </label>
                </div>
                
                <div id="registration-error" class="hidden text-red-500 text-sm text-center"></div>
                
                <button type="submit" id="register-submit-btn"
                    class="w-full py-3 bg-primary text-white font-medium rounded-button shadow-sm cursor-pointer">
                    <span id="register-btn-text">Register with MMU SSO</span>
                    <div id="register-spinner" class="hidden ml-2 inline-block">
                        <i class="ri-loader-4-line animate-spin"></i>
                    </div>
                </button>
            </form>
        </div>
    </div>

    <!-- MMU Verification Success Modal (Default Hidden) -->
    <div id="verification-success-modal" class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-[9999] hidden">
        <div class="bg-white rounded-lg p-5 w-4/5 max-w-sm">
            <div class="flex flex-col items-center">
                <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mb-4">
                    <i class="ri-check-line text-green-500 ri-2x"></i>
                </div>
                <h3 class="text-lg font-medium mb-2">MMU Verification Successful</h3>
                <p class="text-sm text-gray-600 text-center mb-4">Your MMU credentials have been verified. Your account has been created successfully.</p>
                <button id="verification-success-btn"
                    class="w-full py-3 bg-primary text-white font-medium rounded-button cursor-pointer">
                    Continue to Login
                </button>
            </div>
        </div>
    </div>

    <!-- MMU Verification Pending Modal (Default Hidden) -->
    <div id="verification-pending-modal" class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-[9999] hidden">
        <div class="bg-white rounded-lg p-5 w-4/5 max-w-sm">
            <div class="flex flex-col items-center">
                <div class="w-16 h-16 bg-yellow-100 rounded-full flex items-center justify-center mb-4">
                    <i class="ri-mail-send-line text-yellow-500 ri-2x"></i>
                </div>
                <h3 class="text-lg font-medium mb-2">Verification Email Sent</h3>
                <p class="text-sm text-gray-600 text-center mb-4">We've sent a verification link to your MMU email. Please check your inbox and click the link to complete your registration.</p>
                <button id="verification-pending-btn"
                    class="w-full py-3 bg-primary text-white font-medium rounded-button cursor-pointer">
                    Return to Login
                </button>
            </div>
        </div>
    </div>

    <!-- Main App (Initially Hidden) -->
    <div id="main-app" class="hidden">

    <!-- Remove the registration modals from inside the main app -->

    <!-- Fix the passenger profile modal's avatar-container -->
        <!-- Passenger Profile Modal (Default Hidden) -->
        <div id="passenger-profile-modal" class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-[9999] hidden">
            <div class="bg-white rounded-lg w-full max-w-sm m-4 overflow-hidden">
                <div class="relative">
                    <div class="h-24 bg-secondary"></div>
                    <button id="close-passenger-profile" class="absolute top-2 right-2 w-8 h-8 bg-white bg-opacity-20 rounded-full flex items-center justify-center">
                        <i class="ri-close-line text-white"></i>
                    </button>
                    <div class="absolute top-12 left-4">
                        <div class="w-20 h-20 rounded-full bg-gray-200 border-4 border-white overflow-hidden avatar-container">
                            <img id="passenger-profile-image" alt="Passenger avatar" class="w-full h-full object-cover">
                            <div class="avatar-fallback" style="display:none;">PC</div>
                        </div>
                    </div>
                </div>
                
                <div class="p-4 pt-12">
                    <div class="flex justify-between items-center mb-1">
                        <h3 id="passenger-profile-name" class="text-lg font-medium">Passenger Name</h3>
                        <div class="flex items-center">
                            <i class="ri-star-fill text-yellow-400 mr-1"></i>
                            <span id="passenger-profile-rating" class="text-sm">4.9</span>
                        </div>
                    </div>
                    <p id="passenger-profile-faculty" class="text-sm text-gray-500 mb-3">MMU Computer Science</p>
                    
                    <!-- Passenger Stats -->
                    <div class="grid grid-cols-3 gap-2 mb-4">
                        <div class="bg-gray-50 rounded-lg p-2 text-center">
                            <p id="passenger-profile-rides" class="font-medium">47</p>
                            <p class="text-xs text-gray-500">Rides</p>
                        </div>
                        <div class="bg-gray-50 rounded-lg p-2 text-center">
                            <p id="passenger-profile-joined" class="font-medium">5 mo</p>
                            <p class="text-xs text-gray-500">Member</p>
                        </div>
                        <div class="bg-gray-50 rounded-lg p-2 text-center">
                            <p id="passenger-profile-points" class="font-medium">185</p>
                            <p class="text-xs text-gray-500">Points</p>
                        </div>
                    </div>
                    
                    <!-- Ride Preferences -->
                    <div class="bg-gray-50 rounded-lg p-3 mb-4">
                        <h4 class="text-sm font-medium mb-2">Ride Preferences</h4>
                        <div class="flex flex-wrap gap-2">
                            <span class="px-2 py-1 bg-blue-100 text-blue-700 rounded-full text-xs">Quiet ride</span>
                            <span class="px-2 py-1 bg-blue-100 text-blue-700 rounded-full text-xs">AC preferred</span>
                            <span class="px-2 py-1 bg-blue-100 text-blue-700 rounded-full text-xs">Front seat</span>
                        </div>
                    </div>
                    
                    <!-- User Reviews -->
                    <h4 class="text-sm font-medium mb-2">Reviews</h4>
                    <div class="space-y-3 mb-4">
                        <div class="bg-gray-50 rounded-lg p-3">
                            <div class="flex items-center mb-1">
                                <div class="w-6 h-6 rounded-full bg-gray-200 overflow-hidden mr-2 avatar-container">
                                    <img src="" alt="Driver avatar" class="w-full h-full object-cover">
                                    <div class="avatar-fallback" style="display:flex;">TW</div>
                                </div>
                                <p class="text-xs font-medium">Tan W.</p>
                                <div class="flex items-center ml-auto">
                                    <i class="ri-star-fill text-yellow-400 text-xs"></i>
                                    <i class="ri-star-fill text-yellow-400 text-xs"></i>
                                    <i class="ri-star-fill text-yellow-400 text-xs"></i>
                                    <i class="ri-star-fill text-yellow-400 text-xs"></i>
                                    <i class="ri-star-fill text-yellow-400 text-xs"></i>
                                </div>
                            </div>
                            <p class="text-xs text-gray-700">Great passenger, very punctual and polite!</p>
                        </div>
                        
                        <div class="bg-gray-50 rounded-lg p-3">
                            <div class="flex items-center mb-1">
                                <div class="w-6 h-6 rounded-full bg-gray-200 overflow-hidden mr-2 avatar-container">
                                    <img src="" alt="Driver avatar" class="w-full h-full object-cover">
                                    <div class="avatar-fallback" style="display:flex;">NA</div>
                                </div>
                                <p class="text-xs font-medium">Nurul A.</p>
                                <div class="flex items-center ml-auto">
                                    <i class="ri-star-fill text-yellow-400 text-xs"></i>
                                    <i class="ri-star-fill text-yellow-400 text-xs"></i>
                                    <i class="ri-star-fill text-yellow-400 text-xs"></i>
                                    <i class="ri-star-fill text-yellow-400 text-xs"></i>
                                    <i class="ri-star-fill text-gray-200 text-xs"></i>
                                </div>
                            </div>
                            <p class="text-xs text-gray-700">Good passenger but was a bit late for pickup.</p>
                        </div>
                    </div>
                    
                    <!-- Action Buttons -->
                    <div class="flex space-x-2">
                        <button class="flex-1 py-2 flex items-center justify-center bg-secondary text-white text-sm rounded-button">
                            <i class="ri-message-3-line mr-1"></i>Message
                        </button>
                        <button class="flex-1 py-2 flex items-center justify-center bg-gray-100 text-gray-700 text-sm rounded-button">
                            <i class="ri-share-forward-line mr-1"></i>Share Profile
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Navigation Bar -->
        <div class="nav-bar bg-white shadow-md">
            <div class="flex items-center justify-between px-4 py-3">
                <div class="flex items-center">
                    <div class="flex items-center">
                        <i class="ri-car-fill text-primary text-xl mr-1"></i>
                        <h1 class="text-xl font-['Pacifico'] text-primary">MMU Rides</h1>
                    </div>
                </div>
                <div class="flex items-center space-x-3">
                    <div class="w-8 h-8 flex items-center justify-center relative cursor-pointer"
                        id="open-notifications">
                        <i class="ri-notification-3-line ri-lg"></i>
                        <div
                            class="absolute -top-1 -right-1 w-5 h-5 bg-red-500 rounded-full flex items-center justify-center text-white text-xs">
                            4
                    </div>
                    </div>
                    <div class="w-8 h-8 flex items-center justify-center cursor-pointer" id="nav-profile-btn">
                        <i class="ri-user-line ri-lg"></i>
                    </div>
                </div>
            </div>
            <!-- Segment Control -->
            <div class="flex px-4 pb-2">
                <div class="w-full bg-gray-100 rounded-full p-1 flex">
                    <button id="btn-find-ride"
                        class="flex-1 py-2 rounded-full bg-primary text-white text-center font-medium cursor-pointer flex items-center justify-center">
                        <i class="ri-search-line mr-2"></i>Find
                    </button>
                    <button id="btn-offer-ride"
                        class="flex-1 py-2 rounded-full text-gray-600 text-center font-medium cursor-pointer flex items-center justify-center">
                        <i class="ri-steering-2-line mr-2"></i>Offer
                    </button>
                </div>
            </div>
        </div>

        <!-- Notifications Panel (Default Hidden) -->
        <div id="notifications-panel"
            class="fixed top-0 right-0 w-full max-w-sm h-full bg-white shadow-xl z-50 transform translate-x-full transition-transform duration-300">
            <div class="flex justify-between items-center p-4 border-b border-gray-100">
                <h2 class="text-lg font-medium">Notifications</h2>
                <button id="close-notifications" class="text-gray-500">
                    <i class="ri-close-line ri-lg"></i>
                </button>
            </div>
            <div class="overflow-y-auto h-[calc(100%-60px)] p-3 space-y-3">
                <!-- Notification 1 - Ride Confirmation -->
                <div class="bg-green-50 p-3 rounded-lg">
                    <div class="flex items-start">
                        <div
                            class="w-8 h-8 bg-green-100 rounded-full flex items-center justify-center mr-3 flex-shrink-0">
                            <i class="ri-check-line text-green-500"></i>
                        </div>
                        <div class="flex-1">
                            <p class="text-sm font-medium text-green-800">Ride Request Approved</p>
                            <p class="text-xs text-gray-600 mt-1">Your request to join Tan Wei Ming's ride to City
                                Center Mall has been approved.</p>
                            <div class="flex justify-between items-center mt-2">
                                <span class="text-xs text-gray-500">5 mins ago</span>
                                <button class="text-xs text-primary">View Details</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Notification 2 - Points Earned -->
                <div class="bg-primary bg-opacity-5 p-3 rounded-lg">
                    <div class="flex items-start">
                        <div
                            class="w-8 h-8 bg-primary bg-opacity-20 rounded-full flex items-center justify-center mr-3 flex-shrink-0">
                            <i class="ri-award-line text-primary"></i>
                        </div>
                        <div class="flex-1">
                            <p class="text-sm font-medium text-primary">Points Earned</p>
                            <p class="text-xs text-gray-600 mt-1">You earned 25 points for completing a ride as a
                                driver. Keep it up!</p>
                            <div class="flex justify-between items-center mt-2">
                                <span class="text-xs text-gray-500">Yesterday</span>
                                <button class="text-xs text-primary">View Points</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Notification 3 - Ride Cancellation -->
                <div class="bg-red-50 p-3 rounded-lg">
                    <div class="flex items-start">
                        <div
                            class="w-8 h-8 bg-red-100 rounded-full flex items-center justify-center mr-3 flex-shrink-0">
                            <i class="ri-close-line text-red-500"></i>
                        </div>
                        <div class="flex-1">
                            <p class="text-sm font-medium text-red-800">Ride Cancelled</p>
                            <p class="text-xs text-gray-600 mt-1">Dr. Rajesh Subramaniam has cancelled the ride to Tech
                                Park scheduled for today at 17:45.</p>
                            <div class="flex justify-between items-center mt-2">
                                <span class="text-xs text-gray-500">2 days ago</span>
                                <button class="text-xs text-primary">Find Alternative</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Notification 4 - Parking -->
                <div class="bg-blue-50 p-3 rounded-lg">
                    <div class="flex items-start">
                        <div
                            class="w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center mr-3 flex-shrink-0">
                            <i class="ri-parking-box-line text-blue-500"></i>
                        </div>
                        <div class="flex-1">
                            <p class="text-sm font-medium text-blue-800">Parking Reminder</p>
                            <p class="text-xs text-gray-600 mt-1">Carpool Parking Zone has 5 spots left. Remember to use
                                your verified driver status for priority parking.</p>
                            <div class="flex justify-between items-center mt-2">
                                <span class="text-xs text-gray-500">3 days ago</span>
                                <button class="text-xs text-primary">View Map</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Load More -->
                <button class="w-full text-center text-primary text-sm py-3 border-t border-gray-100">
                    Load More
                </button>
            </div>
        </div>
        <!-- Main Content Area -->
        <div class="content">
            <!-- Find Ride Page -->
            <div id="find-ride-page" class="main-content">
                <!-- Search Bar -->
                <div class="bg-white rounded-lg shadow-sm mb-3">
                    <div class="p-3">
                        <div class="flex space-x-2">
                            <div class="relative flex-1">
                                <input type="text" placeholder="Search"
                                    class="w-full pl-9 pr-4 py-2 rounded-full bg-gray-100 border-none focus:outline-none focus:ring-2 focus:ring-primary">
                            <div class="absolute left-3 top-2 w-5 h-5 flex items-center justify-center">
                                <i class="ri-search-line text-gray-500"></i>
                            </div>
                        </div>
                            <button id="open-filter" class="px-3 py-2 bg-gray-100 rounded-full flex items-center justify-center text-gray-700">
                                <i class="ri-filter-3-line"></i>
                            </button>
                    </div>
                    </div>
                    <div class="flex px-3 pb-3 gap-2 overflow-x-auto">
                        <button class="px-2 py-1 bg-gray-100 rounded-full text-xs text-gray-700 cursor-pointer whitespace-nowrap flex items-center">
                            <i class="ri-time-line mr-1"></i>Today
                        </button>
                        <button class="px-2 py-1 bg-gray-100 rounded-full text-xs text-gray-700 cursor-pointer whitespace-nowrap flex items-center">
                            <i class="ri-calendar-line mr-1"></i>Tomorrow
                        </button>
                        <button class="px-2 py-1 bg-gray-100 rounded-full text-xs text-gray-700 cursor-pointer whitespace-nowrap flex items-center">
                            <i class="ri-team-line mr-1"></i>2+ seats
                        </button>
                </div>
                </div>
                <!-- Available Rides List -->
                <div class="flex items-center justify-between mb-3">
                    <h2 class="text-base font-medium">Available Rides</h2>
                    <span class="text-xs text-primary">See All</span>
                </div>
                
                <div class="space-y-3">
                    <!-- Ride Card 1 -->
                    <div class="bg-white rounded-lg shadow-sm p-3 cursor-pointer" onclick="showRideDetails(1)">
                        <div class="flex justify-between items-start mb-3">
                            <div class="flex items-center">
                                <div class="w-9 h-9 rounded-full bg-gray-200 overflow-hidden mr-2 avatar-container">
                                    <img src="https://readdy.ai/api/search-image?query=professional%20portrait%20of%20a%20young%20Malaysian%20Chinese%20male%20student%20with%20glasses%2C%20smiling%2C%20casual%20attire%2C%20university%20campus%20background%2C%20natural%20lighting%2C%20friendly%20expression&width=100&height=100&seq=1&orientation=squarish"
                                        alt="Driver avatar" class="w-full h-full object-cover" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                                    <div class="avatar-fallback" style="display:none;">TW</div>
                                </div>
                                <div>
                                    <h3 class="font-medium truncate-text">Tan Wei Ming</h3>
                                    <div class="flex items-center text-xs text-gray-500">
                                        <i class="ri-star-fill text-yellow-400 mr-1"></i>
                                        <span>4.8</span>
                                    </div>
                                </div>
                            </div>
                            <div
                                class="bg-primary bg-opacity-10 text-primary px-2 py-1 rounded-full text-xs font-medium flex items-center">
                                <i class="ri-user-line mr-1"></i>3
                            </div>
                        </div>
                        <div class="flex mb-2">
                            <div class="w-6 flex flex-col items-center mr-2">
                                <div class="w-2 h-2 rounded-full bg-primary"></div>
                                <div class="w-0.5 h-8 bg-gray-300"></div>
                                <div class="w-2 h-2 rounded-full bg-secondary"></div>
                            </div>
                            <div class="flex-1">
                                <div class="mb-1">
                                    <p class="text-xs text-gray-500">From</p>
                                    <p class="text-sm font-medium">MMU Main Campus Library</p>
                                </div>
                                <div>
                                    <p class="text-xs text-gray-500">To</p>
                                    <p class="text-sm font-medium">City Center Mall</p>
                                </div>
                            </div>
                        </div>
                        <div class="flex justify-between text-xs">
                            <div class="flex items-center">
                                <i class="ri-time-line text-gray-500 mr-1"></i>
                                <span>Today 15:30</span>
                            </div>
                            <div class="flex items-center">
                                <i class="ri-car-line text-gray-500 mr-1"></i>
                                <span>Toyota Corolla</span>
                            </div>
                        </div>
                    </div>
                    <!-- Ride Card 2 -->
                    <div class="bg-white rounded-lg shadow-sm p-3 cursor-pointer" onclick="showRideDetails(2)">
                        <div class="flex justify-between items-start mb-3">
                            <div class="flex items-center">
                                <div class="w-9 h-9 rounded-full bg-gray-200 overflow-hidden mr-2 avatar-container">
                                    <img src="https://readdy.ai/api/search-image?query=professional%20portrait%20of%20a%20young%20Malaysian%20Malay%20female%20student%20with%20hijab%2C%20casual%20attire%2C%20university%20campus%20background%2C%20natural%20lighting%2C%20friendly%20expression%2C%20confident%20pose&width=100&height=100&seq=2&orientation=squarish"
                                        alt="Driver avatar" class="w-full h-full object-cover">
                                    <div class="avatar-fallback" style="display:none;">NA</div>
                                </div>
                                <div>
                                    <h3 class="font-medium truncate-text">Nurul Aisha binti Abdullah</h3>
                                    <div class="flex items-center text-xs text-gray-500">
                                        <i class="ri-star-fill text-yellow-400 mr-1"></i>
                                        <span>4.9</span>
                                    </div>
                                </div>
                            </div>
                            <div
                                class="bg-primary bg-opacity-10 text-primary px-2 py-1 rounded-full text-xs font-medium flex items-center">
                                <i class="ri-user-line mr-1"></i>2
                            </div>
                        </div>
                        <div class="flex mb-3">
                            <div class="w-6 flex flex-col items-center mr-2">
                                <div class="w-3 h-3 rounded-full bg-primary"></div>
                                <div class="w-0.5 h-10 bg-gray-300"></div>
                                <div class="w-3 h-3 rounded-full bg-secondary"></div>
                            </div>
                            <div class="flex-1">
                                <div class="mb-2">
                                    <p class="text-xs text-gray-500">From</p>
                                    <p class="font-medium">MMU Student Dormitory</p>
                                </div>
                                <div>
                                    <p class="text-xs text-gray-500">To</p>
                                    <p class="font-medium">Train Station</p>
                                </div>
                            </div>
                        </div>
                        <div class="flex justify-between text-sm">
                            <div class="flex items-center">
                                <div class="w-4 h-4 flex items-center justify-center mr-1">
                                    <i class="ri-time-line text-gray-500"></i>
                                </div>
                                <span>Tomorrow 08:00</span>
                            </div>
                            <div class="flex items-center">
                                <div class="w-4 h-4 flex items-center justify-center mr-1">
                                    <i class="ri-car-line text-gray-500"></i>
                                </div>
                                <span>Honda Civic</span>
                            </div>
                        </div>
                    </div>
                    <!-- Ride Card 3 -->
                    <div class="bg-white rounded-lg shadow-sm p-3 cursor-pointer" onclick="showRideDetails(3)">
                        <div class="flex justify-between items-start mb-3">
                            <div class="flex items-center">
                                <div class="w-9 h-9 rounded-full bg-gray-200 overflow-hidden mr-2 avatar-container">
                                    <img src="https://readdy.ai/api/search-image?query=professional%20portrait%20of%20a%20mature%20Malaysian%20Indian%20male%20university%20professor%2C%20casual%20smart%20attire%2C%20glasses%2C%20university%20office%20background%2C%20natural%20lighting%2C%20friendly%20professional%20expression&width=100&height=100&seq=3&orientation=squarish"
                                        alt="Driver avatar" class="w-full h-full object-cover">
                                    <div class="avatar-fallback" style="display:none;">RS</div>
                                </div>
                                <div>
                                    <h3 class="font-medium truncate-text">Dr. Rajesh Subramaniam</h3>
                                    <div class="flex items-center text-xs text-gray-500">
                                        <i class="ri-star-fill text-yellow-400 mr-1"></i>
                                        <span>5.0</span>
                                    </div>
                                </div>
                            </div>
                            <div
                                class="bg-primary bg-opacity-10 text-primary px-2 py-1 rounded-full text-xs font-medium flex items-center">
                                <i class="ri-user-line mr-1"></i>1
                            </div>
                        </div>
                        <div class="flex mb-3">
                            <div class="w-6 flex flex-col items-center mr-2">
                                <div class="w-3 h-3 rounded-full bg-primary"></div>
                                <div class="w-0.5 h-10 bg-gray-300"></div>
                                <div class="w-3 h-3 rounded-full bg-secondary"></div>
                            </div>
                            <div class="flex-1">
                                <div class="mb-2">
                                    <p class="text-xs text-gray-500">From</p>
                                    <p class="font-medium">MMU Science Building</p>
                                </div>
                                <div>
                                    <p class="text-xs text-gray-500">To</p>
                                    <p class="font-medium">Tech Park</p>
                                </div>
                            </div>
                        </div>
                        <div class="flex justify-between text-sm">
                            <div class="flex items-center">
                                <div class="w-4 h-4 flex items-center justify-center mr-1">
                                    <i class="ri-time-line text-gray-500"></i>
                                </div>
                                <span>Today 17:45</span>
                            </div>
                            <div class="flex items-center">
                                <div class="w-4 h-4 flex items-center justify-center mr-1">
                                    <i class="ri-car-line text-gray-500"></i>
                                </div>
                                <span>Tesla Model 3</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Offer Ride Page (Default Hidden) -->
            <div id="offer-ride-page" class="main-content hidden">
                <div class="bg-white rounded-lg shadow-sm p-4 mb-4">
                    <h2 class="text-lg font-medium mb-3">Publish Ride</h2>
                    <div class="space-y-3">
                        <div>
                            <div class="relative">
                                <input type="text" placeholder="From"
                                    class="w-full pl-9 pr-4 py-3 rounded-button bg-gray-100 border-none focus:outline-none focus:ring-2 focus:ring-primary">
                                <div class="absolute left-3 top-3 w-5 h-5 flex items-center justify-center">
                                    <i class="ri-map-pin-line text-gray-500"></i>
                                </div>
                            </div>
                        </div>
                        <div>
                            <div class="relative">
                                <input type="text" placeholder="To"
                                    class="w-full pl-9 pr-4 py-3 rounded-button bg-gray-100 border-none focus:outline-none focus:ring-2 focus:ring-primary">
                                <div class="absolute left-3 top-3 w-5 h-5 flex items-center justify-center">
                                    <i class="ri-map-pin-line text-gray-500"></i>
                                </div>
                            </div>
                        </div>
                        <div class="grid grid-cols-2 gap-3">
                            <div>
                                <div class="relative">
                                    <input type="date"
                                        class="w-full pl-9 pr-1 py-2.5 rounded-button bg-gray-100 border-none focus:outline-none focus:ring-2 focus:ring-primary text-xs"
                                        style="-webkit-appearance: none; appearance: none;">
                                    <div class="absolute left-3 top-3 w-5 h-5 flex items-center justify-center">
                                        <i class="ri-calendar-line text-gray-500"></i>
                                    </div>
                                </div>
                            </div>
                            <div>
                                <div class="relative">
                                    <input type="time"
                                        class="w-full pl-9 pr-4 py-3 rounded-button bg-gray-100 border-none focus:outline-none focus:ring-2 focus:ring-primary">
                                    <div class="absolute left-3 top-3 w-5 h-5 flex items-center justify-center">
                                        <i class="ri-time-line text-gray-500"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div>
                            <div class="flex space-x-3 mb-2">
                                <span class="text-sm text-gray-600">Seats:</span>
                                <div class="flex space-x-2">
                                    <button class="w-8 h-8 rounded-full bg-gray-100 flex items-center justify-center hover:bg-gray-200">1</button>
                                    <button class="w-8 h-8 rounded-full bg-primary text-white flex items-center justify-center">2</button>
                                    <button class="w-8 h-8 rounded-full bg-gray-100 flex items-center justify-center hover:bg-gray-200">3</button>
                                    <button class="w-8 h-8 rounded-full bg-gray-100 flex items-center justify-center hover:bg-gray-200">4</button>
                                </div>
                            </div>
                        </div>
                        <div>
                            <textarea placeholder="Notes (optional)"
                                class="w-full px-4 py-3 rounded-button bg-gray-100 border-none focus:outline-none focus:ring-2 focus:ring-primary"
                                rows="2"></textarea>
                        </div>
                        <button
                            class="w-full py-3 bg-primary text-white font-medium rounded-button shadow-sm cursor-pointer hover:bg-primary-dark flex items-center justify-center">
                            <i class="ri-add-line mr-2"></i> Create Ride
                        </button>
                    </div>
                </div>

                <!-- NEW: Approve Rides Section -->
                <div class="bg-white rounded-lg shadow-sm p-4 mb-4">
                    <h3 class="text-md font-medium mb-3">Ride Requests to Approve</h3>
                    
                    <!-- Request 1 -->
                    <div class="border border-gray-100 rounded-lg p-3 mb-3">
                        <div class="flex justify-between items-start mb-2">
                            <div class="flex items-center">
                                <div class="w-8 h-8 rounded-full bg-gray-200 overflow-hidden mr-2">
                                    <img src="https://readdy.ai/api/search-image?query=professional%20portrait%20of%20a%20young%20Asian%20male%20student%20with%20glasses%2C%20smiling%2C%20casual%20attire%2C%20university%20campus%20background%2C%20natural%20lighting%2C%20friendly%20expression&width=100&height=100&seq=4&orientation=squarish"
                                        alt="Passenger avatar" class="w-full h-full object-cover">
                                </div>
                                <div>
                                    <h3 class="text-sm font-medium truncate-text">Ahmad bin Hassan</h3>
                                    <div class="flex items-center text-xs text-gray-500">
                                        <i class="ri-star-fill text-yellow-400 mr-1"></i>
                                        <span>4.7</span>
                                    </div>
                                </div>
                            </div>
                            <div class="text-xs text-primary">
                                New
                            </div>
                        </div>
                        
                        <div class="flex items-center justify-between text-xs text-gray-500 mb-2">
                            <div><i class="ri-map-pin-line mr-1"></i>City Center Mall</div>
                            <div><i class="ri-time-line mr-1"></i>Today 15:30</div>
                            <div><i class="ri-user-line mr-1"></i>1 seat</div>
                        </div>
                        
                        <div class="flex space-x-2">
                            <button class="flex-1 py-2 flex items-center justify-center bg-primary text-white text-sm rounded-button">
                                <i class="ri-check-line mr-1"></i>Approve
                            </button>
                            <button class="flex-1 py-2 flex items-center justify-center bg-gray-100 text-gray-700 text-sm rounded-button">
                                <i class="ri-close-line mr-1"></i>Decline
                            </button>
                        </div>
                    </div>
                    
                    <!-- Request 2 -->
                    <div class="border border-gray-100 rounded-lg p-3 mb-3">
                        <div class="flex justify-between items-start mb-2">
                            <div class="flex items-center">
                                <div class="w-8 h-8 rounded-full bg-gray-200 overflow-hidden mr-2">
                                    <img src="https://readdy.ai/api/search-image?query=professional%20portrait%20of%20a%20young%20Asian%20female%20student%20with%20glasses%2C%20smiling%2C%20casual%20attire%2C%20university%20campus%20background%2C%20natural%20lighting%2C%20friendly%20expression&width=100&height=100&seq=5&orientation=squarish"
                                        alt="Passenger avatar" class="w-full h-full object-cover">
                                </div>
                                <div>
                                    <h3 class="text-sm font-medium truncate-text">Lim Mei Ling</h3>
                                    <div class="flex items-center text-xs text-gray-500">
                                        <i class="ri-star-fill text-yellow-400 mr-1"></i>
                                        <span>4.9</span>
                                    </div>
                                </div>
                            </div>
                            <div class="text-xs text-primary">
                                New
                            </div>
                        </div>
                        
                        <div class="flex items-center justify-between text-xs text-gray-500 mb-2">
                            <div><i class="ri-map-pin-line mr-1"></i>Train Station</div>
                            <div><i class="ri-time-line mr-1"></i>Tomorrow</div>
                            <div><i class="ri-user-line mr-1"></i>2 seats</div>
                        </div>
                        
                        <div class="flex space-x-2">
                            <button class="flex-1 py-2 flex items-center justify-center bg-primary text-white text-sm rounded-button">
                                <i class="ri-check-line mr-1"></i>Approve
                            </button>
                            <button class="flex-1 py-2 flex items-center justify-center bg-gray-100 text-gray-700 text-sm rounded-button">
                                <i class="ri-close-line mr-1"></i>Decline
                            </button>
                        </div>
                    </div>
                </div>

                <div class="bg-white rounded-lg shadow-sm p-3">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center">
                            <div class="w-9 h-9 bg-primary bg-opacity-10 rounded-lg flex items-center justify-center mr-2">
                                <i class="ri-car-fill text-primary"></i>
                            </div>
                            <div>
                                <p class="text-sm font-medium">Toyota Corolla</p>
                                <p class="text-xs text-gray-500">WVS 3291</p>
                            </div>
                        </div>
                        <button class="text-primary cursor-pointer">
                            <i class="ri-edit-line ri-lg"></i>
                        </button>
                    </div>
                </div>
            </div>
            <!-- Ride Details Page (Default Hidden) -->
            <div id="ride-details-page" class="main-content hidden">
                <div class="mb-4">
                    <button id="back-to-find" class="flex items-center text-primary cursor-pointer">
                        <i class="ri-arrow-left-line mr-1"></i>
                        <span>Back</span>
                    </button>
                </div>
                <div class="bg-white rounded-lg shadow-sm p-4 mb-4">
                    <div class="flex justify-between items-start mb-4">
                        <div class="flex items-center">
                            <div class="w-12 h-12 rounded-full bg-gray-200 overflow-hidden mr-3">
                                <img src="https://readdy.ai/api/search-image?query=professional%20portrait%20of%20a%20young%20Malaysian%20Chinese%20male%20student%20with%20glasses%2C%20smiling%2C%20casual%20attire%2C%20university%20campus%20background%2C%20natural%20lighting%2C%20friendly%20expression&width=100&height=100&seq=1&orientation=squarish"
                                    alt="Driver avatar" class="w-full h-full object-cover">
                            </div>
                            <div>
                                <h3 class="font-medium">Chen Zhiming</h3>
                                <div class="flex items-center text-xs text-gray-500">
                                    <i class="ri-star-fill text-yellow-400 mr-1"></i>
                                    <span>4.8 (124 reviews)</span>
                                </div>
                            </div>
                        </div>
                        <button class="text-primary cursor-pointer">
                            <i class="ri-message-3-line ri-lg"></i>
                        </button>
                    </div>
                    <div class="flex mb-4">
                        <div class="w-6 flex flex-col items-center mr-2">
                            <div class="w-3 h-3 rounded-full bg-primary"></div>
                            <div class="w-0.5 h-16 bg-gray-300"></div>
                            <div class="w-3 h-3 rounded-full bg-secondary"></div>
                        </div>
                        <div class="flex-1">
                            <div class="mb-4">
                                <p class="text-xs text-gray-500">From</p>
                                <p class="font-medium">MMU Main Campus Library</p>
                                <p class="text-xs text-gray-500 mt-1">Today 15:30</p>
                            </div>
                            <div>
                                <p class="text-xs text-gray-500">To</p>
                                <p class="font-medium">City Center Mall</p>
                                <p class="text-xs text-gray-500 mt-1">Expected arrival 16:15</p>
                            </div>
                        </div>
                    </div>
                    <div class="border-t border-gray-100 pt-4">
                        <div class="flex justify-between mb-3">
                            <div class="flex items-center">
                                <div class="w-5 h-5 flex items-center justify-center mr-2">
                                    <i class="ri-car-line text-gray-500"></i>
                                </div>
                                <span class="text-sm">Toyota Corolla (White)</span>
                            </div>
                            <div class="text-sm">WVS 3291</div>
                        </div>
                        <div class="flex justify-between">
                            <div class="flex items-center">
                                <div class="w-5 h-5 flex items-center justify-center mr-2">
                                    <i class="ri-user-line text-gray-500"></i>
                                </div>
                                <span class="text-sm">Available Seats</span>
                            </div>
                            <div class="text-sm font-medium text-primary">3 seats</div>
                        </div>
                    </div>
                </div>
                <div class="bg-white rounded-lg shadow-sm p-4 mb-4">
                    <h3 class="text-md font-medium mb-3">Passenger Information</h3>
                <div class="flex items-center mb-3 cursor-pointer" id="view-passenger-profile">
                        <div class="w-8 h-8 rounded-full bg-gray-200 overflow-hidden mr-2">
                            <img src="https://readdy.ai/api/search-image?query=professional%20portrait%20of%20a%20young%20Asian%20female%20student%2C%20casual%20attire%2C%20university%20campus%20background%2C%20natural%20lighting%2C%20friendly%20expression&width=100&height=100&seq=4&orientation=squarish"
                                alt="Passenger avatar" class="w-full h-full object-cover">
                        </div>
                        <div class="flex-1">
                            <p class="font-medium truncate-text">Preetha Chandran</p>
                            <p class="text-xs text-gray-500">MMU Computer Science</p>
                        </div>
                        <div class="flex items-center text-xs text-gray-500">
                            <i class="ri-star-fill text-yellow-400 mr-1"></i>
                            <span>4.7</span>
                        </div>
                    </div>
                    <div class="border-t border-gray-100 pt-3 mt-3 text-center">
                        <p class="text-gray-500 text-sm">3 available seats left</p>
                    </div>
                </div>
                <button id="request-ride-btn"
                    class="w-full py-3 bg-primary text-white font-medium rounded-button shadow-sm mb-4 cursor-pointer hover:bg-primary-dark">
                    Request to Join
                </button>
                <div class="bg-gray-100 rounded-lg p-4">
                    <h3 class="text-md font-medium mb-2">Safety Tips</h3>
                    <p class="text-sm text-gray-600">Please meet in public places, confirm vehicle information before
                        getting in, and share trip details with family and friends.</p>
                </div>
            </div>
            <!-- Parking Map Page (Default Hidden) -->
            <div id="parking-map-page" class="main-content hidden">
                <div class="bg-white rounded-lg shadow-sm mb-4">
                    <div class="p-3">
                        <div class="relative">
                            <input type="text" placeholder="Search parking areas"
                                class="w-full pl-10 pr-4 py-2 rounded-button bg-gray-100 border-none focus:outline-none focus:ring-2 focus:ring-primary">
                            <div class="absolute left-3 top-2 w-5 h-5 flex items-center justify-center">
                                <i class="ri-search-line text-gray-500"></i>
                            </div>
                        </div>
                    </div>
                    <div class="flex px-3 pb-3 space-x-2">
                        <button class="px-3 py-1 bg-primary text-white rounded-full text-xs cursor-pointer">All</button>
                        <button class="px-3 py-1 bg-gray-100 rounded-full text-xs text-gray-700 cursor-pointer">Carpool
                            Zone</button>
                        <button class="px-3 py-1 bg-gray-100 rounded-full text-xs text-gray-700 cursor-pointer">Regular
                            Zone</button>
                    </div>
                </div>
                <div class="bg-white rounded-lg shadow-sm mb-4 overflow-hidden">
                    <div class="h-48 bg-cover bg-center"
                        style="background-image: url('https://public.readdy.ai/gen_page/map_placeholder_1280x720.png')">
                    </div>
                </div>
                <h2 class="text-lg font-medium mb-3">Available Parking Spaces</h2>
                <div class="space-y-3">
                    <div class="bg-white rounded-lg shadow-sm p-3 flex items-center cursor-pointer">
                        <div
                            class="w-10 h-10 bg-primary bg-opacity-10 rounded-lg flex items-center justify-center mr-3">
                            <i class="ri-parking-box-line text-primary ri-lg"></i>
                        </div>
                        <div class="flex-1">
                            <h3 class="font-medium">Main Building Parking</h3>
                            <div class="flex items-center text-xs text-gray-500">
                                <div class="w-3 h-3 flex items-center justify-center mr-1">
                                    <i class="ri-map-pin-line"></i>
                                </div>
                                <span>300m away</span>
                            </div>
                        </div>
                        <div class="text-right">
                            <div class="text-green-500 font-medium">12 spaces</div>
                            <div class="text-xs text-gray-500">out of 50</div>
                        </div>
                    </div>
                    <div class="bg-white rounded-lg shadow-sm p-3 flex items-center cursor-pointer">
                        <div
                            class="w-10 h-10 bg-secondary bg-opacity-10 rounded-lg flex items-center justify-center mr-3">
                            <i class="ri-parking-box-line text-secondary ri-lg"></i>
                        </div>
                        <div class="flex-1">
                            <h3 class="font-medium">Carpool Parking Zone</h3>
                            <div class="flex items-center text-xs text-gray-500">
                                <div class="w-3 h-3 flex items-center justify-center mr-1">
                                    <i class="ri-map-pin-line"></i>
                                </div>
                                <span>150m away</span>
                            </div>
                        </div>
                        <div class="text-right">
                            <div class="text-green-500 font-medium">8 spaces</div>
                            <div class="text-xs text-gray-500">out of 20</div>
                        </div>
                    </div>
                    <div class="bg-white rounded-lg shadow-sm p-3 flex items-center cursor-pointer">
                        <div
                            class="w-10 h-10 bg-primary bg-opacity-10 rounded-lg flex items-center justify-center mr-3">
                            <i class="ri-parking-box-line text-primary ri-lg"></i>
                        </div>
                        <div class="flex-1">
                            <h3 class="font-medium">Library Parking</h3>
                            <div class="flex items-center text-xs text-gray-500">
                                <div class="w-3 h-3 flex items-center justify-center mr-1">
                                    <i class="ri-map-pin-line"></i>
                                </div>
                                <span>450m away</span>
                            </div>
                        </div>
                        <div class="text-right">
                            <div class="text-yellow-500 font-medium">3 spaces</div>
                            <div class="text-xs text-gray-500">out of 30</div>
                        </div>
                    </div>
                    <div class="bg-white rounded-lg shadow-sm p-3 flex items-center cursor-pointer">
                        <div
                            class="w-10 h-10 bg-primary bg-opacity-10 rounded-lg flex items-center justify-center mr-3">
                            <i class="ri-parking-box-line text-primary ri-lg"></i>
                        </div>
                        <div class="flex-1">
                            <h3 class="font-medium">Student Dorm Parking</h3>
                            <div class="flex items-center text-xs text-gray-500">
                                <div class="w-3 h-3 flex items-center justify-center mr-1">
                                    <i class="ri-map-pin-line"></i>
                                </div>
                                <span>600m away</span>
                            </div>
                        </div>
                        <div class="text-right">
                            <div class="text-red-500 font-medium">Full</div>
                            <div class="text-xs text-gray-500">out of 40</div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Messages Page (Default Hidden) -->
            <div id="messages-page" class="main-content hidden">
                <div class="bg-white rounded-lg shadow-sm mb-4">
                    <div class="p-3">
                        <div class="relative">
                            <input type="text" placeholder="Search messages"
                                class="w-full pl-10 pr-4 py-2 rounded-button bg-gray-100 border-none focus:outline-none focus:ring-2 focus:ring-primary">
                            <div class="absolute left-3 top-2 w-5 h-5 flex items-center justify-center">
                                <i class="ri-search-line text-gray-500"></i>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="space-y-3">
                    <div class="bg-white rounded-lg shadow-sm p-3 flex items-center cursor-pointer"
                        onclick="showChatPage()">
                        <div class="relative mr-3">
                            <div class="w-12 h-12 rounded-full bg-gray-200 overflow-hidden">
                                <img src="https://readdy.ai/api/search-image?query=professional%20portrait%20of%20a%20young%20Asian%20male%20student%20with%20glasses%2C%20smiling%2C%20casual%20attire%2C%20university%20campus%20background%2C%20natural%20lighting%2C%20friendly%20expression&width=100&height=100&seq=1&orientation=squarish"
                                    alt="User avatar" class="w-full h-full object-cover">
                            </div>
                            <div
                                class="absolute -top-1 -right-1 w-5 h-5 bg-primary rounded-full flex items-center justify-center text-white text-xs">
                                2
                            </div>
                        </div>
                        <div class="flex-1">
                            <div class="flex justify-between">
                                <h3 class="font-medium">Chen Zhiming</h3>
                                <span class="text-xs text-gray-500">10:30</span>
                            </div>
                            <p class="text-sm text-gray-600 truncate-text">I'm at the library. Where are you?</p>
                        </div>
                    </div>
                    <div class="bg-white rounded-lg shadow-sm p-3 flex items-center cursor-pointer">
                        <div class="w-12 h-12 rounded-full bg-gray-200 overflow-hidden mr-3">
                            <img src="https://readdy.ai/api/search-image?query=professional%20portrait%20of%20a%20young%20Asian%20female%20student%2C%20casual%20attire%2C%20university%20campus%20background%2C%20natural%20lighting%2C%20friendly%20expression%2C%20confident%20pose&width=100&height=100&seq=2&orientation=squarish"
                                alt="User avatar" class="w-full h-full object-cover">
                        </div>
                        <div class="flex-1">
                            <div class="flex justify-between">
                                <h3 class="font-medium">Lin Xiaoyu</h3>
                                <span class="text-xs text-gray-500">Yesterday</span>
                            </div>
                            <p class="text-sm text-gray-600 truncate-text">Any space for 8 AM tomorrow?</p>
                        </div>
                    </div>
                    <div class="bg-white rounded-lg shadow-sm p-3 flex items-center cursor-pointer">
                        <div class="w-12 h-12 rounded-full bg-gray-200 overflow-hidden mr-3">
                            <img src="https://readdy.ai/api/search-image?query=professional%20portrait%20of%20a%20mature%20male%20university%20professor%2C%20casual%20smart%20attire%2C%20glasses%2C%20university%20office%20background%2C%20natural%20lighting%2C%20friendly%20professional%20expression&width=100&height=100&seq=3&orientation=squarish"
                                alt="User avatar" class="w-full h-full object-cover">
                        </div>
                        <div class="flex-1">
                            <div class="flex justify-between">
                                <h3 class="font-medium">Prof. Wang</h3>
                                <span class="text-xs text-gray-500">Monday</span>
                            </div>
                            <p class="text-sm text-gray-600 truncate-text">Thanks for the ride! Very punctual.</p>
                        </div>
                    </div>
                    <div class="bg-white rounded-lg shadow-sm p-3 flex items-center cursor-pointer">
                        <div class="w-12 h-12 rounded-full bg-gray-200 overflow-hidden mr-3">
                            <img src="https://readdy.ai/api/search-image?query=professional%20portrait%20of%20a%20young%20Asian%20female%20student%20with%20long%20hair%2C%20casual%20attire%2C%20university%20campus%20background%2C%20natural%20lighting%2C%20friendly%20expression&width=100&height=100&seq=5&orientation=squarish"
                                alt="User avatar" class="w-full h-full object-cover">
                        </div>
                        <div class="flex-1">
                            <div class="flex justify-between">
                                <h3 class="font-medium truncate-text">Siti Nurhayati</h3>
                                <span class="text-xs text-gray-500">Last week</span>
                            </div>
                            <p class="text-sm text-gray-600 truncate-text">Ride to downtown Monday?</p>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Chat Details Page (Default Hidden) -->
            <div id="chat-page" class="main-content hidden">
                <div class="mb-4">
                    <button id="back-to-messages" class="flex items-center text-primary cursor-pointer">
                        <i class="ri-arrow-left-line mr-1"></i>
                        <span>Back</span>
                    </button>
                </div>
                <div class="bg-white rounded-lg shadow-sm p-3 flex items-center mb-4">
                    <div class="w-10 h-10 rounded-full bg-gray-200 overflow-hidden mr-3">
                        <img src="https://readdy.ai/api/search-image?query=professional%20portrait%20of%20a%20young%20Asian%20male%20student%20with%20glasses%2C%20smiling%2C%20casual%20attire%2C%20university%20campus%20background%2C%20natural%20lighting%2C%20friendly%20expression&width=100&height=100&seq=1&orientation=squarish"
                            alt="User avatar" class="w-full h-full object-cover">
                    </div>
                    <div class="flex-1">
                        <h3 class="font-medium truncate-text">Tan Wei Ming</h3>
                        <p class="text-xs text-gray-500">Today's 15:30 rideshare</p>
                    </div>
                    <button class="text-primary cursor-pointer">
                        <i class="ri-more-2-fill ri-lg"></i>
                    </button>
                </div>
                <div class="space-y-3 mb-4 px-1">
                    <div class="flex justify-start">
                        <div class="bg-gray-100 rounded-lg rounded-tl-none p-3 chat-bubble">
                            <p class="text-sm message-text">Hello, I'm Tan Wei Ming, your driver today.</p>
                            <p class="text-xs text-gray-500 text-right mt-1">10:15</p>
                        </div>
                    </div>
                    <div class="flex justify-end">
                        <div class="bg-primary text-white rounded-lg rounded-tr-none p-3 chat-bubble">
                            <p class="text-sm message-text">Hi! I've applied to join your ride.</p>
                            <p class="text-xs text-white text-right mt-1 opacity-70">10:18</p>
                        </div>
                    </div>
                    <div class="flex justify-start">
                        <div class="bg-gray-100 rounded-lg rounded-tl-none p-3 chat-bubble">
                            <p class="text-sm message-text">Great, I've accepted your request. Let's meet at the
                                library.</p>
                            <p class="text-xs text-gray-500 text-right mt-1">10:20</p>
                        </div>
                    </div>
                    <div class="flex justify-end">
                        <div class="bg-primary text-white rounded-lg rounded-tr-none p-3 chat-bubble">
                            <p class="text-sm message-text">No problem, I'll be there on time.</p>
                            <p class="text-xs text-white text-right mt-1 opacity-70">10:22</p>
                        </div>
                    </div>
                    <div class="flex justify-start">
                        <div class="bg-gray-100 rounded-lg rounded-tl-none p-3 chat-bubble">
                            <p class="text-sm message-text">I'm at the library. Where are you?</p>
                            <p class="text-xs text-gray-500 text-right mt-1">10:30</p>
                        </div>
                    </div>
                </div>
                <div class="bg-white rounded-lg shadow-sm p-3 flex items-center">
                    <div class="w-10 h-10 flex items-center justify-center cursor-pointer">
                        <i class="ri-image-line ri-lg text-gray-500"></i>
                    </div>
                    <input type="text" placeholder="Type a message..."
                        class="flex-1 px-3 py-2 mx-2 rounded-full bg-gray-100 border-none focus:outline-none">
                    <div class="w-10 h-10 flex items-center justify-center bg-primary rounded-full cursor-pointer">
                        <i class="ri-send-plane-fill text-white"></i>
                    </div>
                </div>
            </div>
            <!-- Profile Page (Default Hidden) -->
            <div id="profile-page" class="main-content hidden">
                <div class="bg-white rounded-lg shadow-sm p-4 mb-4">
                    <div class="flex items-center">
                        <div class="w-16 h-16 rounded-full bg-gray-200 overflow-hidden mr-4">
                            <img src="https://readdy.ai/api/search-image?query=professional%20portrait%20of%20a%20young%20Asian%20female%20student%20with%20glasses%2C%20smiling%2C%20casual%20attire%2C%20university%20campus%20background%2C%20natural%20lighting%2C%20friendly%20expression&width=100&height=100&seq=6&orientation=squarish"
                                alt="User avatar" class="w-full h-full object-cover">
                        </div>
                        <div>
                            <h2 class="text-xl font-medium truncate-text">Aisha Wong Abdullah</h2>
                            <p class="text-sm text-gray-500 mb-1">MMU Computer Science</p>
                            <div class="flex items-center">
                                <div class="flex items-center mr-4">
                                    <i class="ri-star-fill text-yellow-400 mr-1"></i>
                                    <span class="text-sm">4.9</span>
                                </div>
                                <div class="text-sm text-primary cursor-pointer">Edit Profile</div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="bg-white rounded-lg shadow-sm p-4 mb-4">
                    <h3 class="text-md font-medium mb-3">My Points</h3>
                    <div class="flex justify-between items-center mb-4">
                        <div>
                            <p class="text-3xl font-medium text-primary">285</p>
                            <p class="text-xs text-gray-500">45 points earned this month</p>
                        </div>
                        <button id="open-rewards"
                            class="px-3 py-2 bg-primary text-white rounded-button text-sm cursor-pointer">
                            Redeem Rewards
                        </button>
                    </div>
                    <div class="mt-3">
                        <div class="flex justify-between text-sm mb-2">
                            <span>Next Level</span>
                            <span>350 / 500</span>
                        </div>
                        <div class="w-full h-3 bg-gray-100 rounded-full overflow-hidden">
                            <div class="h-full bg-primary" style="width: 70%"></div>
                        </div>
                    </div>
                </div>
                <div class="bg-white rounded-lg shadow-sm mb-4">
                    <div class="p-4 border-b border-gray-100">
                        <h3 class="text-md font-medium">My Features</h3>
                    </div>
                    <div class="grid grid-cols-4 p-4">
                        <div class="flex flex-col items-center justify-center cursor-pointer px-1">
                            <div
                                class="w-12 h-12 rounded-lg bg-primary bg-opacity-10 flex items-center justify-center mb-2">
                                <i class="ri-history-line text-primary"></i>
                            </div>
                            <span class="text-xs text-center">Trip History</span>
                        </div>
                        <div id="goto-my-vehicles"
                            class="flex flex-col items-center justify-center cursor-pointer px-1">
                            <div
                                class="w-12 h-12 rounded-lg bg-primary bg-opacity-10 flex items-center justify-center mb-2">
                                <i class="ri-car-line text-primary"></i>
                            </div>
                            <span class="text-xs text-center">My Vehicles</span>
                        </div>
                        <div id="goto-safety-center"
                            class="flex flex-col items-center justify-center cursor-pointer px-1">
                            <div
                                class="w-12 h-12 rounded-lg bg-primary bg-opacity-10 flex items-center justify-center mb-2">
                                <i class="ri-shield-check-line text-primary"></i>
                            </div>
                            <span class="text-xs text-center">Safety Center</span>
                        </div>
                        <div class="flex flex-col items-center justify-center cursor-pointer px-1">
                            <div
                                class="w-12 h-12 rounded-lg bg-primary bg-opacity-10 flex items-center justify-center mb-2">
                                <i class="ri-settings-3-line text-primary"></i>
                            </div>
                            <span class="text-xs text-center">Settings</span>
                        </div>
                    </div>
                </div>
                <div class="bg-white rounded-lg shadow-sm mb-4">
                    <div class="p-4 border-b border-gray-100">
                        <h3 class="text-md font-medium">My Trips</h3>
                    </div>
                    <div class="p-4 space-y-4">
                        <!-- In Progress Ride -->
                        <div class="flex items-center justify-between p-2 rounded-lg hover:bg-gray-50 cursor-pointer trip-item" data-trip-id="1" data-status="in-progress">
                            <div class="flex items-center">
                                <div
                                    class="w-10 h-10 bg-primary bg-opacity-10 rounded-lg flex items-center justify-center mr-3">
                                    <i class="ri-steering-2-line text-primary"></i>
                                </div>
                                <div>
                                    <p class="font-medium">MMU Main Campus → City Center</p>
                                    <p class="text-xs text-gray-500">Today 15:30 | Driver</p>
                                </div>
                            </div>
                            <div class="flex items-center">
                                <div class="text-xs text-white bg-green-500 px-3 py-1 rounded-full flex items-center justify-center text-center mr-1">
                                In Progress
                            </div>
                        </div>
                        </div>

                        <!-- Completed but unrated ride -->
                        <div class="flex items-center justify-between p-2 rounded-lg hover:bg-gray-50 cursor-pointer trip-item" data-trip-id="2" data-status="completed" data-rated="false">
                            <div class="flex items-center">
                                <div class="w-10 h-10 bg-gray-100 rounded-lg flex items-center justify-center mr-3">
                                    <i class="ri-user-line text-gray-500"></i>
                                </div>
                                <div>
                                    <p class="font-medium">Train Station → MMU Student Dorm</p>
                                    <p class="text-xs text-gray-500">Yesterday 18:45 | Passenger</p>
                                </div>
                            </div>
                            <div class="flex flex-col items-end">
                                <div class="text-xs text-gray-500 mb-1">
                                Completed
                            </div>
                                <div class="px-3 py-1 rounded-full bg-yellow-100 flex items-center text-yellow-600 feedback-badge">
                                    <i class="ri-star-line mr-1"></i>
                                    <span class="text-xs font-medium">Rate</span>
                        </div>
                            </div>
                        </div>
                        
                        <!-- Completed and rated ride -->
                        <div class="flex items-center justify-between p-2 rounded-lg hover:bg-gray-50 cursor-pointer trip-item" data-trip-id="3" data-status="completed" data-rated="true" data-rating="5" data-feedback="Great driver, very punctual and friendly!">
                            <div class="flex items-center">
                                <div class="w-10 h-10 bg-gray-100 rounded-lg flex items-center justify-center mr-3">
                                    <i class="ri-user-line text-gray-500"></i>
                                </div>
                                <div>
                                    <p class="font-medium">Tech Park → MMU Science Building</p>
                                    <p class="text-xs text-gray-500">Today 10:15 | Passenger</p>
                                </div>
                            </div>
                            <div class="flex flex-col items-end">
                                <div class="text-xs text-gray-500 mb-1">
                                Completed
                            </div>
                                <div class="px-3 py-1 rounded-full bg-green-100 flex items-center text-green-600 feedback-badge">
                                    <i class="ri-check-line mr-1"></i>
                                    <span class="text-xs font-medium">Rated</span>
                        </div>
                            </div>
                        </div>
                        
                        <!-- Another completed but unrated ride -->
                        <div class="flex items-center justify-between p-2 rounded-lg hover:bg-gray-50 cursor-pointer trip-item" data-trip-id="4" data-status="completed" data-rated="false">
                            <div class="flex items-center">
                                <div
                                    class="w-10 h-10 bg-primary bg-opacity-10 rounded-lg flex items-center justify-center mr-3">
                                    <i class="ri-steering-2-line text-primary"></i>
                                </div>
                                <div>
                                    <p class="font-medium">MMU Science Building → Shopping Mall</p>
                                    <p class="text-xs text-gray-500">2025-05-18 | Driver</p>
                                </div>
                            </div>
                            <div class="flex flex-col items-end">
                                <div class="text-xs text-gray-500 mb-1">
                                Completed
                            </div>
                                <div class="px-3 py-1 rounded-full bg-yellow-100 flex items-center text-yellow-600 feedback-badge">
                                    <i class="ri-star-line mr-1"></i>
                                    <span class="text-xs font-medium">Rate</span>
                        </div>
                            </div>
                        </div>
                        
                        <button class="w-full text-center text-primary text-sm py-2 cursor-pointer">
                            View More
                        </button>
                    </div>
                </div>
            </div>

            <!-- My Vehicles Page (Default Hidden) -->
            <div id="my-vehicles-page" class="main-content hidden">
                <div class="mb-4">
                    <button id="back-to-profile-from-vehicles" class="flex items-center text-primary cursor-pointer">
                        <i class="ri-arrow-left-line mr-1"></i>
                        <span>Back</span>
                    </button>
                </div>
                <div class="bg-white rounded-lg shadow-sm p-4 mb-4">
                    <h2 class="text-lg font-medium mb-4">My Vehicles</h2>
                    <div class="space-y-4">
                        <!-- Vehicle 1 -->
                        <div class="bg-gray-50 rounded-lg p-3">
                            <div class="flex items-center justify-between mb-2">
                                <div class="flex items-center">
                                    <div
                                        class="w-12 h-12 bg-primary bg-opacity-10 rounded-lg flex items-center justify-center mr-3">
                                        <i class="ri-car-fill text-primary ri-lg"></i>
                                    </div>
                                    <div>
                                        <h3 class="font-medium">Toyota Corolla</h3>
                                        <div class="flex items-center text-xs text-gray-500">
                                            <span class="mr-2">Sedan</span>
                                            <span>WVS 3291</span>
                                        </div>
                                    </div>
                                </div>
                                <div>
                                    <button class="text-primary cursor-pointer">
                                        <i class="ri-edit-line ri-lg"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="grid grid-cols-3 text-center border-t border-gray-200 pt-2 mt-2">
                                <div class="text-xs">
                                    <p class="text-gray-500">Color</p>
                                    <p class="font-medium">White</p>
                                </div>
                                <div class="text-xs">
                                    <p class="text-gray-500">Seats</p>
                                    <p class="font-medium">4</p>
                                </div>
                                <div class="text-xs">
                                    <p class="text-gray-500">Status</p>
                                    <p class="font-medium text-green-500">Active</p>
                                </div>
                            </div>
                        </div>

                        <!-- Vehicle 2 -->
                        <div class="bg-gray-50 rounded-lg p-3">
                            <div class="flex items-center justify-between mb-2">
                                <div class="flex items-center">
                                    <div
                                        class="w-12 h-12 bg-primary bg-opacity-10 rounded-lg flex items-center justify-center mr-3">
                                        <i class="ri-caravan-fill text-primary ri-lg"></i>
                                    </div>
                                    <div>
                                        <h3 class="font-medium">Honda CRV</h3>
                                        <div class="flex items-center text-xs text-gray-500">
                                            <span class="mr-2">SUV</span>
                                            <span>BKD 7582</span>
                                        </div>
                                    </div>
                                </div>
                                <div>
                                    <button class="text-primary cursor-pointer">
                                        <i class="ri-edit-line ri-lg"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="grid grid-cols-3 text-center border-t border-gray-200 pt-2 mt-2">
                                <div class="text-xs">
                                    <p class="text-gray-500">Color</p>
                                    <p class="font-medium">Silver</p>
                                </div>
                                <div class="text-xs">
                                    <p class="text-gray-500">Seats</p>
                                    <p class="font-medium">5</p>
                                </div>
                                <div class="text-xs">
                                    <p class="text-gray-500">Status</p>
                                    <p class="font-medium text-gray-500">Inactive</p>
                                </div>
                            </div>
                        </div>

                        <!-- Vehicle 3 -->
                        <div class="bg-gray-50 rounded-lg p-3">
                            <div class="flex items-center justify-between mb-2">
                                <div class="flex items-center">
                                    <div
                                        class="w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center mr-3">
                                        <i class="ri-roadster-fill text-green-600 ri-lg"></i>
                                    </div>
                                    <div>
                                        <h3 class="font-medium">Toyota Prius</h3>
                                        <div class="flex items-center text-xs text-gray-500">
                                            <span class="mr-2">Hybrid</span>
                                            <span>JNC 8419</span>
                                        </div>
                                    </div>
                                </div>
                                <div>
                                    <button class="text-primary cursor-pointer">
                                        <i class="ri-edit-line ri-lg"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="grid grid-cols-3 text-center border-t border-gray-200 pt-2 mt-2">
                                <div class="text-xs">
                                    <p class="text-gray-500">Color</p>
                                    <p class="font-medium">Blue</p>
                                </div>
                                <div class="text-xs">
                                    <p class="text-gray-500">Seats</p>
                                    <p class="font-medium">4</p>
                                </div>
                                <div class="text-xs">
                                    <p class="text-gray-500">Status</p>
                                    <p class="font-medium text-green-500">Active</p>
                                </div>
                            </div>
                        </div>

                        <!-- Add New Vehicle Button -->
                        <button
                            class="w-full py-3 flex items-center justify-center bg-gray-50 border border-dashed border-gray-300 text-primary rounded-lg cursor-pointer hover:bg-gray-100">
                            <i class="ri-add-line mr-2"></i>
                            <span>Add New Vehicle</span>
                        </button>
                    </div>
                </div>

                <div class="bg-white rounded-lg shadow-sm p-4 mb-4">
                    <h3 class="text-md font-medium mb-3">Vehicle Insurance Information</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <div class="flex items-center">
                                <div class="w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center mr-3">
                                    <i class="ri-file-shield-2-line text-green-600"></i>
                                </div>
                                <div>
                                    <p class="font-medium">Toyota Corolla Insurance</p>
                                    <p class="text-xs text-gray-500">Valid until 15 Dec 2025</p>
                                </div>
                            </div>
                            <button class="text-primary text-sm">View</button>
                        </div>
                        <div class="flex justify-between items-center">
                            <div class="flex items-center">
                                <div class="w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center mr-3">
                                    <i class="ri-file-shield-2-line text-green-600"></i>
                                </div>
                                <div>
                                    <p class="font-medium">Toyota Prius Insurance</p>
                                    <p class="text-xs text-gray-500">Valid until 03 Aug 2025</p>
                                </div>
                            </div>
                            <button class="text-primary text-sm">View</button>
                        </div>
                    </div>
                </div>

                <div class="bg-white rounded-lg shadow-sm p-4">
                    <h3 class="text-md font-medium mb-3">Vehicle Preferences</h3>
                    <div class="space-y-4">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm font-medium">Default vehicle for rides</p>
                                <p class="text-xs text-gray-500">Used when offering new rides</p>
                            </div>
                            <select
                                class="bg-gray-100 px-3 py-2 rounded-lg text-sm border-none focus:ring-2 focus:ring-primary">
                                <option>Toyota Corolla</option>
                                <option>Honda CRV</option>
                                <option>Toyota Prius</option>
                            </select>
                        </div>
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm font-medium">Auto-verify vehicle details</p>
                                <p class="text-xs text-gray-500">Show vehicle details in ride listings</p>
                            </div>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" value="" class="sr-only peer" checked>
                                <div
                                    class="w-11 h-6 bg-gray-300 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-primary">
                                </div>
                            </label>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Safety Center Page (Default Hidden) -->
            <div id="safety-page" class="main-content hidden">
                <div class="mb-4">
                    <button id="back-to-profile" class="flex items-center text-primary cursor-pointer">
                        <i class="ri-arrow-left-line mr-1"></i>
                        <span>Back</span>
                    </button>
                </div>
                <div class="bg-white rounded-lg shadow-sm p-4 mb-4">
                    <h2 class="text-lg font-medium mb-3">Safety Center</h2>
                    <p class="text-sm text-gray-600 mb-4">We value your safety. The following features can help you stay
                        safe during carpooling.</p>
                    <button
                        class="w-full py-3 bg-red-500 text-white font-medium rounded-button shadow-sm mb-4 flex items-center justify-center cursor-pointer">
                        <i class="ri-alarm-warning-fill mr-2"></i>
                        <span>Emergency Help (SOS)</span>
                    </button>
                    <div class="space-y-4">
                        <div class="bg-gray-100 rounded-lg p-3">
                            <h3 class="font-medium mb-2">Emergency Contacts</h3>
                            <div class="flex items-center justify-between mb-3">
                                <div class="flex items-center">
                                    <div
                                        class="w-8 h-8 bg-primary bg-opacity-10 rounded-full flex items-center justify-center mr-2">
                                        <i class="ri-user-line text-primary"></i>
                                    </div>
                                    <div>
                                        <p class="font-medium truncate-text">Noor Ahmad bin Razak</p>
                                        <p class="text-xs text-gray-500">138****5678</p>
                                    </div>
                                </div>
                                <button class="text-primary cursor-pointer">
                                    <i class="ri-edit-line"></i>
                                </button>
                            </div>
                            <button class="text-primary text-sm cursor-pointer">
                                + Add more contacts
                            </button>
                        </div>
                        <div class="bg-gray-100 rounded-lg p-3">
                            <h3 class="font-medium mb-2">Trip Sharing</h3>
                            <p class="text-sm text-gray-600 mb-3">Share your real-time trip location and details with
                                family and friends</p>
                            <button
                                class="w-full py-2 border border-primary text-primary rounded-button cursor-pointer">
                                Share Current Trip
                            </button>
                        </div>
                        <div class="bg-gray-100 rounded-lg p-3">
                            <div class="flex justify-between items-center">
                                <h3 class="font-medium">Auto Recording</h3>
                                <label class="relative inline-flex items-center cursor-pointer">
                                    <input type="checkbox" value="" class="sr-only peer" checked>
                                    <div
                                        class="w-11 h-6 bg-gray-300 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-primary">
                                    </div>
                                </label>
                            </div>
                            <p class="text-sm text-gray-600 mt-1">Automatically record audio during trips to enhance
                                safety</p>
                        </div>
                    </div>
                </div>
                <div class="bg-white rounded-lg shadow-sm p-4">
                    <h3 class="text-md font-medium mb-3">Safety Tips</h3>
                    <div class="space-y-3">
                        <div class="flex">
                            <div
                                class="w-8 h-8 bg-primary bg-opacity-10 rounded-full flex items-center justify-center mr-3 flex-shrink-0">
                                <i class="ri-check-line text-primary"></i>
                            </div>
                            <p class="text-sm text-gray-600">Meet in public places, avoid secluded locations.</p>
                        </div>
                        <div class="flex">
                            <div
                                class="w-8 h-8 bg-primary bg-opacity-10 rounded-full flex items-center justify-center mr-3 flex-shrink-0">
                                <i class="ri-check-line text-primary"></i>
                            </div>
                            <p class="text-sm text-gray-600">Confirm driver identity and vehicle information before
                                getting in.</p>
                        </div>
                        <div class="flex">
                            <div
                                class="w-8 h-8 bg-primary bg-opacity-10 rounded-full flex items-center justify-center mr-3 flex-shrink-0">
                                <i class="ri-check-line text-primary"></i>
                            </div>
                            <p class="text-sm text-gray-600">Share your trip details with family and friends.</p>
                        </div>
                        <div class="flex">
                            <div
                                class="w-8 h-8 bg-primary bg-opacity-10 rounded-full flex items-center justify-center mr-3 flex-shrink-0">
                                <i class="ri-check-line text-primary"></i>
                            </div>
                            <p class="text-sm text-gray-600">Trust your instincts and cancel the trip if you feel
                                uncomfortable.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- SOS Floating Button -->
        <div class="sos-button">
            <button id="sos-btn" class="w-14 h-14 bg-red-500 rounded-full shadow-lg flex items-center justify-center">
                <i class="ri-alarm-warning-fill text-white ri-xl"></i>
            </button>
        </div>
        <!-- Bottom Tab Bar -->
        <div class="tab-bar bg-white shadow-lg border-t border-gray-100">
            <div class="grid grid-cols-4 h-16">
                <div id="tab-find" class="flex flex-col items-center justify-center cursor-pointer text-primary">
                    <i class="ri-compass-line text-2xl"></i>
                    <span class="text-[10px]">Discover</span>
                </div>
                <div id="tab-parking" class="flex flex-col items-center justify-center cursor-pointer text-gray-500">
                    <i class="ri-parking-box-line text-2xl"></i>
                    <span class="text-[10px]">Parking</span>
                </div>
                <div id="tab-messages" class="flex flex-col items-center justify-center cursor-pointer text-gray-500">
                    <i class="ri-message-3-line text-2xl"></i>
                    <span class="text-[10px]">Chat</span>
                </div>
                <div id="tab-profile" class="flex flex-col items-center justify-center cursor-pointer text-gray-500">
                    <i class="ri-user-line text-2xl"></i>
                    <span class="text-[10px]">Me</span>
                </div>
            </div>
        </div>

        <!-- Rating & Feedback Modal (Default Hidden) -->
        <div id="rating-modal"
            class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50 hidden">
            <div class="bg-white rounded-lg p-5 w-full max-w-sm">
                <div class="text-center mb-4">
                    <div class="w-16 h-16 rounded-full bg-gray-200 mx-auto mb-3 overflow-hidden">
                        <img id="rated-user-image"
                            src="https://readdy.ai/api/search-image?query=professional%20portrait%20of%20a%20young%20Malaysian%20Malay%20female%20student%20with%20hijab%2C%20casual%20attire%2C%20university%20campus%20background%2C%20natural%20lighting%2C%20friendly%20expression%2C%20confident%20pose&width=100&height=100&seq=2&orientation=squarish"
                            alt="User avatar" class="w-full h-full object-cover">
                    </div>
                    <h3 id="rated-user-name" class="text-lg font-medium">Nurul Aisha binti Abdullah</h3>
                    <p id="rated-user-role" class="text-sm text-gray-500">Driver</p>
                </div>

                <div class="mb-4">
                    <p class="text-sm text-center mb-2">How was your ride experience?</p>
                    <div id="star-rating" class="flex justify-center space-x-2 my-3">
                        <button
                            class="star-btn w-10 h-10 rounded-full bg-gray-100 flex items-center justify-center text-gray-400 hover:bg-yellow-50 hover:text-yellow-400"
                            data-rating="1">
                            <i class="ri-star-line ri-lg"></i>
                        </button>
                        <button
                            class="star-btn w-10 h-10 rounded-full bg-gray-100 flex items-center justify-center text-gray-400 hover:bg-yellow-50 hover:text-yellow-400"
                            data-rating="2">
                            <i class="ri-star-line ri-lg"></i>
                        </button>
                        <button
                            class="star-btn w-10 h-10 rounded-full bg-gray-100 flex items-center justify-center text-gray-400 hover:bg-yellow-50 hover:text-yellow-400"
                            data-rating="3">
                            <i class="ri-star-line ri-lg"></i>
                        </button>
                        <button
                            class="star-btn w-10 h-10 rounded-full bg-gray-100 flex items-center justify-center text-gray-400 hover:bg-yellow-50 hover:text-yellow-400"
                            data-rating="4">
                            <i class="ri-star-line ri-lg"></i>
                        </button>
                        <button
                            class="star-btn w-10 h-10 rounded-full bg-gray-100 flex items-center justify-center text-gray-400 hover:bg-yellow-50 hover:text-yellow-400"
                            data-rating="5">
                            <i class="ri-star-line ri-lg"></i>
                        </button>
                    </div>
                </div>

                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Additional Feedback (Optional)</label>
                    <textarea id="feedback-text" placeholder="Share your experience..."
                        class="w-full px-3 py-2 bg-gray-100 border-none rounded-lg focus:outline-none focus:ring-2 focus:ring-primary"
                        rows="3"></textarea>
                </div>

                <!-- Quick Feedback Tags -->
                <div class="flex flex-wrap gap-2 mb-4">
                    <button class="quick-tag px-3 py-1 bg-gray-100 rounded-full text-xs text-gray-700">Punctual</button>
                    <button class="quick-tag px-3 py-1 bg-gray-100 rounded-full text-xs text-gray-700">Safe
                        Driving</button>
                    <button class="quick-tag px-3 py-1 bg-gray-100 rounded-full text-xs text-gray-700">Clean
                        Vehicle</button>
                    <button class="quick-tag px-3 py-1 bg-gray-100 rounded-full text-xs text-gray-700">Great
                        Conversation</button>
                    <button class="quick-tag px-3 py-1 bg-gray-100 rounded-full text-xs text-gray-700">Helpful</button>
                </div>

                <div class="flex space-x-3">
                    <button id="skip-rating"
                        class="flex-1 py-3 text-gray-500 font-medium rounded-button cursor-pointer">
                        Skip
                    </button>
                    <button id="submit-rating"
                        class="flex-1 py-3 bg-primary text-white font-medium rounded-button cursor-pointer">
                        Submit
                    </button>
                </div>
            </div>
        </div>

        <!-- Request Success Modal (Default Hidden) -->
        <div id="request-success-modal"
            class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50 hidden">
            <div class="bg-white rounded-lg p-5 w-4/5 max-w-sm">
                <div class="flex flex-col items-center">
                    <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mb-4">
                        <i class="ri-check-line text-green-500 ri-2x"></i>
                    </div>
                    <h3 class="text-lg font-medium mb-2">Request Sent</h3>
                    <p class="text-sm text-gray-600 text-center mb-4">Your rideshare request has been successfully sent
                        to the driver. Please wait for approval.</p>
                    <button id="close-modal"
                        class="w-full py-3 bg-primary text-white font-medium rounded-button cursor-pointer">
                        Confirm
                    </button>
                </div>
            </div>
        </div>

        <!-- SOS Alert Modal (Default Hidden) -->
        <div id="sos-modal" class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50 hidden">
            <div class="bg-white rounded-lg p-5 w-4/5 max-w-sm">
                <div class="flex flex-col items-center">
                    <div class="w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mb-4">
                        <i class="ri-alarm-warning-fill text-red-500 ri-2x"></i>
                    </div>
                    <h3 class="text-lg font-medium mb-2">Emergency Alert</h3>
                    <p class="text-sm text-gray-600 text-center mb-4">Sending emergency alert with your current location
                        to your emergency contacts in:</p>

                    <div class="text-3xl font-bold text-red-500 mb-4" id="sos-countdown">10</div>

                    <div class="w-full flex space-x-3">
                        <button id="cancel-sos"
                            class="flex-1 py-3 bg-gray-200 text-gray-700 font-medium rounded-button cursor-pointer">
                            Cancel
                        </button>
                        <button id="send-sos-now"
                            class="flex-1 py-3 bg-red-500 text-white font-medium rounded-button cursor-pointer">
                            Send Now
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Emergency Contacts Modal (Default Hidden) -->
        <div id="emergency-contacts-modal"
            class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50 hidden">
            <div class="bg-white rounded-lg p-5 w-full max-w-sm mx-4 max-h-[90vh] overflow-y-auto">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-medium">Emergency Contacts</h3>
                    <button id="close-emergency-contacts" class="text-gray-500">
                        <i class="ri-close-line ri-lg"></i>
                    </button>
                </div>

                <div class="space-y-4">
                    <div class="bg-gray-50 rounded-lg p-3">
                        <div class="flex items-center justify-between mb-3">
                            <div class="flex items-center">
                                <div
                                    class="w-10 h-10 bg-primary bg-opacity-10 rounded-full flex items-center justify-center mr-3">
                                    <i class="ri-user-line text-primary"></i>
                                </div>
                                <div>
                                    <p class="font-medium">Noor Ahmad bin Razak</p>
                                    <p class="text-xs text-gray-500">+60 12-345 6789</p>
                                </div>
                            </div>
                            <button class="text-primary cursor-pointer">
                                <i class="ri-edit-line"></i>
                            </button>
                        </div>
                    </div>

                    <div class="bg-gray-50 rounded-lg p-3">
                        <div class="flex items-center justify-between mb-3">
                            <div class="flex items-center">
                                <div
                                    class="w-10 h-10 bg-primary bg-opacity-10 rounded-full flex items-center justify-center mr-3">
                                    <i class="ri-user-line text-primary"></i>
                                </div>
                                <div>
                                    <p class="font-medium">Alex Wong</p>
                                    <p class="text-xs text-gray-500">+60 19-876 5432</p>
                                </div>
                            </div>
                            <button class="text-primary cursor-pointer">
                                <i class="ri-edit-line"></i>
                            </button>
                        </div>
                    </div>

                    <button
                        class="flex items-center justify-center w-full py-2 rounded-lg border border-dashed border-gray-300 text-primary cursor-pointer">
                        <i class="ri-add-line mr-1"></i>
                        <span>Add New Contact</span>
                    </button>

                    <div class="pt-4">
                        <h4 class="text-sm font-medium mb-2">Emergency Settings</h4>
                        <div class="flex items-center justify-between mb-3">
                            <div>
                                <p class="text-sm font-medium">Auto-alert on SOS</p>
                                <p class="text-xs text-gray-500">Send alerts to all contacts</p>
                            </div>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" value="" class="sr-only peer" checked>
                                <div
                                    class="w-11 h-6 bg-gray-300 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-primary">
                                </div>
                            </label>
                        </div>
                        <div class="flex items-center justify-between mb-3">
                            <div>
                                <p class="text-sm font-medium">Share ride details</p>
                                <p class="text-xs text-gray-500">Include current ride details in emergency alert</p>
                            </div>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" value="" class="sr-only peer" checked>
                                <div
                                    class="w-11 h-6 bg-gray-300 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-primary">
                                </div>
                            </label>
                        </div>
                    </div>

                    <button id="save-emergency-contacts"
                        class="w-full py-3 bg-primary text-white font-medium rounded-button shadow-sm cursor-pointer mt-2">
                        Save Changes
                    </button>
                </div>
            </div>
        </div>

        <!-- Filter Modal (Default Hidden) -->
        <div id="filter-modal"
            class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50 hidden">
            <div class="bg-white rounded-lg p-5 w-full max-w-sm mx-4 max-h-[90vh] overflow-y-auto">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-medium">Filter Rides</h3>
                    <button id="close-filter" class="text-gray-500">
                        <i class="ri-close-line ri-lg"></i>
                    </button>
                </div>
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Origin</label>
                        <div class="relative">
                            <input type="text" placeholder="Any pickup location"
                                class="w-full pl-10 pr-4 py-2 rounded-button bg-gray-100 border-none focus:outline-none focus:ring-2 focus:ring-primary">
                            <div class="absolute left-3 top-2 w-5 h-5 flex items-center justify-center">
                                <i class="ri-map-pin-line text-gray-500"></i>
                            </div>
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Destination</label>
                        <div class="relative">
                            <input type="text" placeholder="Any destination"
                                class="w-full pl-10 pr-4 py-2 rounded-button bg-gray-100 border-none focus:outline-none focus:ring-2 focus:ring-primary">
                            <div class="absolute left-3 top-2 w-5 h-5 flex items-center justify-center">
                                <i class="ri-map-pin-line text-gray-500"></i>
                            </div>
                        </div>
                    </div>
                    <div class="grid grid-cols-2 gap-3">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Date</label>
                            <div class="relative">
                                <input type="date"
                                    class="w-full pl-10 pr-4 py-2 rounded-button bg-gray-100 border-none focus:outline-none focus:ring-2 focus:ring-primary">
                                <div class="absolute left-3 top-2 w-5 h-5 flex items-center justify-center">
                                    <i class="ri-calendar-line text-gray-500"></i>
                                </div>
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Time</label>
                            <div class="relative">
                                <input type="time"
                                    class="w-full pl-10 pr-4 py-2 rounded-button bg-gray-100 border-none focus:outline-none focus:ring-2 focus:ring-primary">
                                <div class="absolute left-3 top-2 w-5 h-5 flex items-center justify-center">
                                    <i class="ri-time-line text-gray-500"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Vehicle Type</label>
                        <div class="grid grid-cols-3 gap-2">
                            <button
                                class="py-2 rounded-button bg-gray-100 text-center text-sm cursor-pointer hover:bg-gray-200">Any</button>
                            <button
                                class="py-2 rounded-button bg-primary text-white text-center text-sm cursor-pointer">Sedan</button>
                            <button
                                class="py-2 rounded-button bg-gray-100 text-center text-sm cursor-pointer hover:bg-gray-200">SUV</button>
                            <button
                                class="py-2 rounded-button bg-gray-100 text-center text-sm cursor-pointer hover:bg-gray-200">Van</button>
                            <button
                                class="py-2 rounded-button bg-gray-100 text-center text-sm cursor-pointer hover:bg-gray-200">Hybrid</button>
                            <button
                                class="py-2 rounded-button bg-gray-100 text-center text-sm cursor-pointer hover:bg-gray-200">EV</button>
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Seats Needed</label>
                        <div class="flex space-x-2">
                            <button
                                class="flex-1 py-2 rounded-button bg-primary text-white text-center text-sm cursor-pointer">1</button>
                            <button
                                class="flex-1 py-2 rounded-button bg-gray-100 text-center text-sm cursor-pointer hover:bg-gray-200">2</button>
                            <button
                                class="flex-1 py-2 rounded-button bg-gray-100 text-center text-sm cursor-pointer hover:bg-gray-200">3</button>
                            <button
                                class="flex-1 py-2 rounded-button bg-gray-100 text-center text-sm cursor-pointer hover:bg-gray-200">4+</button>
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Distance from You</label>
                        <div class="px-2">
                            <input type="range" min="1" max="20" value="5" class="w-full accent-primary"
                                id="distance-range">
                            <div class="flex justify-between text-xs text-gray-500 mt-1">
                                <span>1 km</span>
                                <span>5 km (selected)</span>
                                <span>20 km</span>
                            </div>
                        </div>
                    </div>
                    <div class="pt-2">
                        <button
                            class="w-full py-3 bg-primary text-white font-medium rounded-button shadow-sm cursor-pointer">
                            Apply Filters
                        </button>
                        <button class="w-full py-3 text-gray-500 font-medium cursor-pointer mt-2">
                            Reset Filters
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- View Feedback Full Page (Default Hidden) -->
        <div id="feedback-details-page" class="fixed inset-0 bg-white z-50 hidden overflow-y-auto" style="width: 390px; margin: 0 auto; top: 0; bottom: 0;">
            <!-- Fixed Header -->
            <div class="sticky top-0 left-0 right-0 flex items-center border-b border-gray-100 px-4 py-3 bg-white z-10">
                <button id="back-from-feedback" class="flex items-center text-primary cursor-pointer">
                    <i class="ri-arrow-left-line mr-1"></i>
                    <span>Back</span>
                </button>
                <h2 class="text-lg font-medium ml-3">Trip Feedback</h2>
            </div>

            <!-- Trip Information - With proper spacing -->
            <div class="px-4 py-3">
                <!-- From/To Information -->
                <div class="flex items-center mb-2">
                    <div class="w-2 h-2 rounded-full bg-secondary mr-2"></div>
                    <div>
                        <p class="text-xs text-gray-500">To</p>
                        <p id="feedback-to" class="font-medium">MMU Science Building</p>
                    </div>
                </div>
                
                <!-- Time and Role Info -->
                <div class="flex items-center text-xs text-gray-600 mb-4">
                    <i class="ri-time-line mr-1"></i>
                    <span id="feedback-time">Today 10:15</span>
                    <span class="mx-2">•</span>
                    <span id="feedback-role">As Passenger</span>
                </div>
                
                <!-- Overall Rating -->
                <div class="mb-4 border-b border-gray-100 pb-3">
                    <p class="text-sm font-medium mb-1">Overall Rating:</p>
                    <div id="feedback-stars" class="flex">
                        <span class="text-yellow-400 mr-1"><i class="ri-star-fill"></i></span>
                        <span class="text-yellow-400 mr-1"><i class="ri-star-fill"></i></span>
                        <span class="text-yellow-400 mr-1"><i class="ri-star-fill"></i></span>
                        <span class="text-yellow-400 mr-1"><i class="ri-star-fill"></i></span>
                        <span class="text-yellow-400 mr-1"><i class="ri-star-fill"></i></span>
                    </div>
                </div>
            </div>

            <!-- Feedback List -->
            <div class="px-4 pb-20" id="feedback-entries-container">
                <h3 class="text-base font-medium mb-3">Feedback</h3>
                
                <!-- Driver Feedback Card -->
                <div class="mb-5 pb-2">
                    <div class="flex items-center mb-2">
                        <div class="w-8 h-8 rounded-full bg-blue-500 flex items-center justify-center text-white font-medium mr-3 overflow-hidden">
                            <span>TM</span>
                        </div>
                        <div>
                            <div class="flex items-center">
                                <h3 class="font-medium mr-2">Tan Wei Ming</h3>
                                <span class="text-xs px-2 py-0.5 bg-blue-100 text-blue-700 rounded-full">Driver</span>
                            </div>
                            <div class="flex items-center text-xs text-gray-500">
                                <i class="ri-time-line mr-1"></i>
                                <span>Submitted 2 days ago</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="flex mb-2">
                        <span class="text-yellow-400 mr-0.5"><i class="ri-star-fill"></i></span>
                        <span class="text-yellow-400 mr-0.5"><i class="ri-star-fill"></i></span>
                        <span class="text-yellow-400 mr-0.5"><i class="ri-star-fill"></i></span>
                        <span class="text-yellow-400 mr-0.5"><i class="ri-star-fill"></i></span>
                        <span class="text-yellow-400 mr-0.5"><i class="ri-star-fill"></i></span>
                    </div>
                    
                    <div class="mb-3">
                        <p class="text-sm text-gray-700">Great passenger, very punctual and friendly! Would be happy to give a ride again.</p>
                    </div>
                    
                    <div class="flex flex-wrap gap-2">
                        <span class="px-3 py-1 bg-blue-100 text-blue-700 rounded-full text-xs">Punctual</span>
                        <span class="px-3 py-1 bg-blue-100 text-blue-700 rounded-full text-xs">Friendly</span>
                        <span class="px-3 py-1 bg-blue-100 text-blue-700 rounded-full text-xs">Pleasant</span>
                    </div>
                </div>
                
                <!-- Passenger Feedback Card -->
                <div class="mb-5 pb-2">
                    <div class="flex items-center mb-2">
                        <div class="w-8 h-8 rounded-full bg-green-500 flex items-center justify-center text-white font-medium mr-3 overflow-hidden">
                            <span>AA</span>
                        </div>
                        <div>
                            <div class="flex items-center">
                                <h3 class="font-medium mr-2">Aisha Wong Abdullah</h3>
                                <span class="text-xs px-2 py-0.5 bg-green-100 text-green-700 rounded-full">Passenger</span>
                            </div>
                            <div class="flex items-center text-xs text-gray-500">
                                <i class="ri-time-line mr-1"></i>
                                <span>Submitted 3 days ago</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="flex mb-2">
                        <span class="text-yellow-400 mr-0.5"><i class="ri-star-fill"></i></span>
                        <span class="text-yellow-400 mr-0.5"><i class="ri-star-fill"></i></span>
                        <span class="text-yellow-400 mr-0.5"><i class="ri-star-fill"></i></span>
                        <span class="text-yellow-400 mr-0.5"><i class="ri-star-fill"></i></span>
                        <span class="text-gray-300 mr-0.5"><i class="ri-star-fill"></i></span>
                    </div>
                    
                    <div class="mb-3">
                        <p class="text-sm text-gray-700">Good experience and comfortable car. Driver was a little quiet but drove safely.</p>
                    </div>
                    
                    <div class="flex flex-wrap gap-2">
                        <span class="px-3 py-1 bg-blue-100 text-blue-700 rounded-full text-xs">Clean Vehicle</span>
                        <span class="px-3 py-1 bg-blue-100 text-blue-700 rounded-full text-xs">Safe Driving</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Rewards Redemption Modal (Default Hidden) -->
        <div id="rewards-modal"
            class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50 hidden">
            <div class="bg-white rounded-lg w-full max-w-lg mx-4 max-h-[90vh] overflow-y-auto">
                <div class="flex justify-between items-center p-4 border-b border-gray-100 sticky top-0 bg-white z-10">
                    <h2 class="text-lg font-medium">Rewards Center</h2>
                    <button id="close-rewards" class="text-gray-500">
                        <i class="ri-close-line ri-lg"></i>
                    </button>
                </div>

                <div class="p-4">
                    <!-- Points Summary -->
                    <div class="bg-primary bg-opacity-5 p-4 rounded-lg mb-5">
                        <div class="flex items-center justify-between mb-3">
                            <div>
                                <p class="text-sm text-gray-600">Your Points</p>
                                <p class="text-3xl font-medium text-primary">285</p>
                            </div>
                            <div
                                class="w-14 h-14 bg-primary bg-opacity-20 rounded-full flex items-center justify-center">
                                <i class="ri-award-fill text-primary ri-xl"></i>
                            </div>
                        </div>
                        <div class="flex space-x-2 text-xs">
                            <div class="flex-1 p-2 bg-white rounded-lg text-center">
                                <p class="text-gray-500">This Month</p>
                                <p class="font-medium">45 pts</p>
                            </div>
                            <div class="flex-1 p-2 bg-white rounded-lg text-center">
                                <p class="text-gray-500">All Time</p>
                                <p class="font-medium">1,230 pts</p>
                            </div>
                            <div class="flex-1 p-2 bg-white rounded-lg text-center">
                                <p class="text-gray-500">Rank</p>
                                <p class="font-medium text-primary">#14</p>
                            </div>
                        </div>
                    </div>

                    <!-- How to Earn Points -->
                    <div class="mb-5">
                        <h3 class="text-md font-medium mb-3">How to Earn Points</h3>
                        <div class="space-y-3">
                            <div class="flex items-center p-3 bg-gray-50 rounded-lg">
                                <div
                                    class="w-10 h-10 bg-primary bg-opacity-10 rounded-full flex items-center justify-center mr-3 flex-shrink-0">
                                    <i class="ri-steering-2-line text-primary"></i>
                                </div>
                                <div class="flex-1">
                                    <p class="font-medium">Driver Trips</p>
                                    <p class="text-xs text-gray-600">10 points per completed trip as a driver</p>
                                </div>
                            </div>
                            <div class="flex items-center p-3 bg-gray-50 rounded-lg">
                                <div
                                    class="w-10 h-10 bg-primary bg-opacity-10 rounded-full flex items-center justify-center mr-3 flex-shrink-0">
                                    <i class="ri-user-line text-primary"></i>
                                </div>
                                <div class="flex-1">
                                    <p class="font-medium">Passenger Trips</p>
                                    <p class="text-xs text-gray-600">5 points per completed trip as a passenger</p>
                                </div>
                            </div>
                            <div class="flex items-center p-3 bg-gray-50 rounded-lg">
                                <div
                                    class="w-10 h-10 bg-primary bg-opacity-10 rounded-full flex items-center justify-center mr-3 flex-shrink-0">
                                    <i class="ri-star-line text-primary"></i>
                                </div>
                                <div class="flex-1">
                                    <p class="font-medium">Good Ratings</p>
                                    <p class="text-xs text-gray-600">2 bonus points for each 5-star rating</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Available Rewards -->
                    <div class="mb-5">
                        <h3 class="text-md font-medium mb-3">Available Rewards</h3>

                        <!-- Priority Parking -->
                        <div class="border border-gray-200 rounded-lg mb-3 overflow-hidden">
                            <div class="p-3 flex items-center">
                                <div
                                    class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center mr-3 flex-shrink-0">
                                    <i class="ri-parking-box-fill text-blue-600"></i>
                                </div>
                                <div class="flex-1">
                                    <p class="font-medium">Priority Parking Reservation</p>
                                    <p class="text-xs text-gray-600">Reserved spot in high-demand campus parking lots
                                    </p>
                                </div>
                                <div class="text-center">
                                    <p class="font-medium text-primary">50</p>
                                    <p class="text-xs text-gray-500">points</p>
                                </div>
                            </div>
                            <div class="bg-gray-50 p-2 flex justify-between items-center">
                                <span class="text-xs text-gray-500">Valid for one day</span>
                                <button class="px-3 py-1 bg-primary text-white rounded-lg text-xs">Redeem</button>
                            </div>
                        </div>

                        <!-- Bookstore Voucher -->
                        <div class="border border-gray-200 rounded-lg mb-3 overflow-hidden">
                            <div class="p-3 flex items-center">
                                <div
                                    class="w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center mr-3 flex-shrink-0">
                                    <i class="ri-book-fill text-green-600"></i>
                                </div>
                                <div class="flex-1">
                                    <p class="font-medium">Bookstore Voucher (RM10)</p>
                                    <p class="text-xs text-gray-600">Discount at campus bookstore on any purchase</p>
                                </div>
                                <div class="text-center">
                                    <p class="font-medium text-primary">100</p>
                                    <p class="text-xs text-gray-500">points</p>
                                </div>
                            </div>
                            <div class="bg-gray-50 p-2 flex justify-between items-center">
                                <span class="text-xs text-gray-500">Valid for 3 months</span>
                                <button class="px-3 py-1 bg-primary text-white rounded-lg text-xs">Redeem</button>
                            </div>
                        </div>

                        <!-- Cafeteria Meal Discount -->
                        <div class="border border-gray-200 rounded-lg mb-3 overflow-hidden">
                            <div class="p-3 flex items-center">
                                <div
                                    class="w-12 h-12 bg-yellow-100 rounded-lg flex items-center justify-center mr-3 flex-shrink-0">
                                    <i class="ri-restaurant-fill text-yellow-600"></i>
                                </div>
                                <div class="flex-1">
                                    <p class="font-medium">Cafeteria Meal Discount (15%)</p>
                                    <p class="text-xs text-gray-600">Discount at any campus cafeteria</p>
                                </div>
                                <div class="text-center">
                                    <p class="font-medium text-primary">75</p>
                                    <p class="text-xs text-gray-500">points</p>
                                </div>
                            </div>
                            <div class="bg-gray-50 p-2 flex justify-between items-center">
                                <span class="text-xs text-gray-500">Valid for 1 month</span>
                                <button class="px-3 py-1 bg-primary text-white rounded-lg text-xs">Redeem</button>
                            </div>
                        </div>

                        <!-- Premium Reward -->
                        <div
                            class="border border-gray-200 rounded-lg overflow-hidden bg-gradient-to-r from-primary to-blue-600">
                            <div class="p-3 flex items-center">
                                <div
                                    class="w-12 h-12 bg-white rounded-lg flex items-center justify-center mr-3 flex-shrink-0">
                                    <i class="ri-vip-crown-fill text-yellow-500"></i>
                                </div>
                                <div class="flex-1">
                                    <p class="font-medium text-white">Semester Parking Pass</p>
                                    <p class="text-xs text-white text-opacity-80">Reserved parking for entire semester
                                    </p>
                                </div>
                                <div class="text-center">
                                    <p class="font-medium text-white">500</p>
                                    <p class="text-xs text-white text-opacity-80">points</p>
                                </div>
                            </div>
                            <div class="bg-white bg-opacity-10 p-2 flex justify-between items-center">
                                <span class="text-xs text-white text-opacity-80">Premium reward</span>
                                <button class="px-3 py-1 bg-white text-primary rounded-lg text-xs">Redeem</button>
                            </div>
                        </div>
                    </div>

                    <!-- Leaderboard -->
                    <div>
                        <h3 class="text-md font-medium mb-3">Carpool Leaderboard</h3>
                        <div class="bg-gray-50 rounded-lg p-3 mb-3">
                            <div class="flex items-center justify-between mb-2">
                                <p class="text-sm font-medium">Top Carpoolers This Month</p>
                                <button class="text-xs text-primary">View Full Ranking</button>
                            </div>

                            <!-- Top 3 Users -->
                            <div class="space-y-3">
                                <!-- 1st Place -->
                                <div class="flex items-center">
                                    <div
                                        class="w-8 h-8 bg-yellow-100 rounded-full flex items-center justify-center mr-2 flex-shrink-0">
                                        <span class="text-yellow-600 font-bold">1</span>
                                    </div>
                                    <div class="flex-1 flex items-center">
                                        <div class="w-8 h-8 rounded-full bg-gray-200 overflow-hidden mr-2">
                                            <img src="https://readdy.ai/api/search-image?query=professional%20portrait%20of%20a%20mature%20Malaysian%20Indian%20male%20university%20professor%2C%20casual%20smart%20attire%2C%20glasses%2C%20university%20office%20background%2C%20natural%20lighting%2C%20friendly%20professional%20expression&width=100&height=100&seq=3&orientation=squarish"
                                                alt="User avatar" class="w-full h-full object-cover">
                                        </div>
                                        <div>
                                            <p class="text-sm font-medium truncate-text">Dr. Rajesh Subramaniam</p>
                                            <div class="flex items-center">
                                                <i class="ri-award-fill text-yellow-500 mr-1 text-xs"></i>
                                                <span class="text-xs text-gray-500">Gold Driver</span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="text-right">
                                        <p class="font-medium">342</p>
                                        <p class="text-xs text-gray-500">points</p>
                                    </div>
                                </div>

                                <!-- 2nd Place -->
                                <div class="flex items-center">
                                    <div
                                        class="w-8 h-8 bg-gray-200 rounded-full flex items-center justify-center mr-2 flex-shrink-0">
                                        <span class="text-gray-600 font-bold">2</span>
                                    </div>
                                    <div class="flex-1 flex items-center">
                                        <div class="w-8 h-8 rounded-full bg-gray-200 overflow-hidden mr-2">
                                            <img src="https://readdy.ai/api/search-image?query=professional%20portrait%20of%20a%20young%20Malaysian%20Malay%20female%20student%20with%20hijab%2C%20casual%20attire%2C%20university%20campus%20background%2C%20natural%20lighting%2C%20friendly%20expression%2C%20confident%20pose&width=100&height=100&seq=2&orientation=squarish"
                                                alt="User avatar" class="w-full h-full object-cover">
                                        </div>
                                        <div>
                                            <p class="text-sm font-medium truncate-text">Nurul Aisha binti Abdullah</p>
                                            <div class="flex items-center">
                                                <i class="ri-award-fill text-gray-400 mr-1 text-xs"></i>
                                                <span class="text-xs text-gray-500">Silver Driver</span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="text-right">
                                        <p class="font-medium">315</p>
                                        <p class="text-xs text-gray-500">points</p>
                                    </div>
                                </div>

                                <!-- 3rd Place -->
                                <div class="flex items-center">
                                    <div
                                        class="w-8 h-8 bg-yellow-800 bg-opacity-20 rounded-full flex items-center justify-center mr-2 flex-shrink-0">
                                        <span class="text-yellow-800 font-bold">3</span>
                                    </div>
                                    <div class="flex-1 flex items-center">
                                        <div class="w-8 h-8 rounded-full bg-gray-200 overflow-hidden mr-2">
                                            <img src="https://readdy.ai/api/search-image?query=professional%20portrait%20of%20a%20young%20Malaysian%20Chinese%20male%20student%20with%20glasses%2C%20smiling%2C%20casual%20attire%2C%20university%20campus%20background%2C%20natural%20lighting%2C%20friendly%20expression&width=100&height=100&seq=1&orientation=squarish"
                                                alt="User avatar" class="w-full h-full object-cover">
                                        </div>
                                        <div>
                                            <p class="text-sm font-medium truncate-text">Tan Wei Ming</p>
                                            <div class="flex items-center">
                                                <i class="ri-award-fill text-yellow-800 mr-1 text-xs"></i>
                                                <span class="text-xs text-gray-500">Bronze Driver</span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="text-right">
                                        <p class="font-medium">290</p>
                                        <p class="text-xs text-gray-500">points</p>
                                    </div>
                                </div>

                                <!-- Your Position -->
                                <div class="flex items-center mt-2 pt-2 border-t border-gray-200">
                                    <div
                                        class="w-8 h-8 bg-primary bg-opacity-10 rounded-full flex items-center justify-center mr-2 flex-shrink-0">
                                        <span class="text-primary font-bold">14</span>
                                    </div>
                                    <div class="flex-1 flex items-center">
                                        <div class="w-8 h-8 rounded-full bg-gray-200 overflow-hidden mr-2">
                                            <img src="https://readdy.ai/api/search-image?query=professional%20portrait%20of%20a%20young%20Asian%20female%20student%20with%20glasses%2C%20smiling%2C%20casual%20attire%2C%20university%20campus%20background%2C%20natural%20lighting%2C%20friendly%20expression&width=100&height=100&seq=6&orientation=squarish"
                                                alt="User avatar" class="w-full h-full object-cover">
                                        </div>
                                        <div>
                                            <p class="text-sm font-medium truncate-text">Aisha Wong Abdullah <span
                                                    class="text-primary text-xs">(You)</span></p>
                                            <div class="flex items-center">
                                                <i class="ri-award-fill text-primary mr-1 text-xs"></i>
                                                <span class="text-xs text-gray-500">Regular User</span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="text-right">
                                        <p class="font-medium">285</p>
                                        <p class="text-xs text-gray-500">points</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Badges -->
                        <div class="bg-gray-50 rounded-lg p-3">
                            <p class="text-sm font-medium mb-3">Your Badges</p>
                            <div class="grid grid-cols-4 gap-2">
                                <div class="flex flex-col items-center">
                                    <div
                                        class="w-12 h-12 bg-green-100 rounded-full flex items-center justify-center mb-1">
                                        <i class="ri-seedling-fill text-green-600"></i>
                                    </div>
                                    <p class="text-xs text-center">Eco Saver</p>
                                </div>
                                <div class="flex flex-col items-center">
                                    <div
                                        class="w-12 h-12 bg-yellow-100 rounded-full flex items-center justify-center mb-1">
                                        <i class="ri-time-fill text-yellow-600"></i>
                                    </div>
                                    <p class="text-xs text-center">Punctual</p>
                                </div>
                                <div class="flex flex-col items-center">
                                    <div
                                        class="w-12 h-12 bg-gray-200 rounded-full flex items-center justify-center mb-1">
                                        <i class="ri-car-fill text-gray-400"></i>
                                    </div>
                                    <p class="text-xs text-center">Locked</p>
                                </div>
                                <div class="flex flex-col items-center">
                                    <div
                                        class="w-12 h-12 bg-gray-200 rounded-full flex items-center justify-center mb-1">
                                        <i class="ri-group-fill text-gray-400"></i>
                                    </div>
                                    <p class="text-xs text-center">Locked</p>
                                </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    <!-- Add the Driver Profile Modal after the rating-modal -->
    <!-- Driver Profile Modal (Default Hidden) -->
    <div id="driver-profile-modal" class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50 hidden">
        <div class="bg-white rounded-lg w-full max-w-sm m-4 overflow-hidden">
            <div class="relative">
                <div class="h-24 bg-primary"></div>
                <button id="close-driver-profile" class="absolute top-2 right-2 w-8 h-8 bg-white bg-opacity-20 rounded-full flex items-center justify-center">
                    <i class="ri-close-line text-white"></i>
                </button>
                <div class="absolute top-12 left-4">
                    <div class="w-20 h-20 rounded-full bg-gray-200 border-4 border-white overflow-hidden avatar-container">
                        <img id="driver-profile-image" src="" alt="Driver avatar" class="w-full h-full object-cover">
                        <div class="avatar-fallback" style="display:none;"></div>
                    </div>
                </div>
            </div>
            
            <div class="p-4 pt-12">
                <div class="flex justify-between items-center mb-1">
                    <h3 id="driver-profile-name" class="text-lg font-medium">Driver Name</h3>
                    <div class="flex items-center">
                        <i class="ri-star-fill text-yellow-400 mr-1"></i>
                        <span id="driver-profile-rating" class="text-sm">4.9</span>
                    </div>
                </div>
                <p id="driver-profile-faculty" class="text-sm text-gray-500 mb-3">MMU Computer Science</p>
                
                <!-- Driver Stats -->
                <div class="grid grid-cols-3 gap-2 mb-4">
                    <div class="bg-gray-50 rounded-lg p-2 text-center">
                        <p id="driver-profile-rides" class="font-medium">124</p>
                        <p class="text-xs text-gray-500">Rides</p>
                    </div>
                    <div class="bg-gray-50 rounded-lg p-2 text-center">
                        <p id="driver-profile-experience" class="font-medium">8 mo</p>
                        <p class="text-xs text-gray-500">Experience</p>
                    </div>
                    <div class="bg-gray-50 rounded-lg p-2 text-center">
                        <p id="driver-profile-points" class="font-medium">320</p>
                        <p class="text-xs text-gray-500">Points</p>
                    </div>
                </div>
                
                <!-- Vehicle Info -->
                <div class="bg-gray-50 rounded-lg p-3 mb-4">
                    <h4 class="text-sm font-medium mb-2">Vehicle Information</h4>
                    <div class="flex items-center">
                        <div class="w-10 h-10 bg-primary bg-opacity-10 rounded-lg flex items-center justify-center mr-3">
                            <i class="ri-car-fill text-primary"></i>
                        </div>
                        <div>
                            <p id="driver-profile-car" class="text-sm font-medium">Toyota Corolla</p>
                            <p id="driver-profile-plate" class="text-xs text-gray-500">WVS 3291</p>
                        </div>
                    </div>
                </div>
                
                <!-- User Reviews -->
                <h4 class="text-sm font-medium mb-2">Reviews</h4>
                <div class="space-y-3 mb-4">
                    <div class="bg-gray-50 rounded-lg p-3">
                        <div class="flex items-center mb-1">
                            <div class="w-6 h-6 rounded-full bg-gray-200 overflow-hidden mr-2">
                                <img src="https://readdy.ai/api/search-image?query=professional%20portrait%20of%20a%20young%20Asian%20female%20student%20with%20glasses%2C%20smiling%2C%20casual%20attire%2C%20university%20campus%20background%2C%20natural%20lighting%2C%20friendly%20expression&width=100&height=100&seq=6&orientation=squarish" alt="User avatar" class="w-full h-full object-cover">
                                </div>
                                <p class="text-xs font-medium">Aisha W.</p>
                                <div class="flex items-center ml-auto">
                                    <i class="ri-star-fill text-yellow-400 text-xs"></i>
                                    <i class="ri-star-fill text-yellow-400 text-xs"></i>
                                    <i class="ri-star-fill text-yellow-400 text-xs"></i>
                                    <i class="ri-star-fill text-yellow-400 text-xs"></i>
                                    <i class="ri-star-fill text-yellow-400 text-xs"></i>
                                </div>
                            </div>
                            <p class="text-xs text-gray-700">Very friendly driver and the car was clean. Arrived on time!</p>
                        </div>
                        
                        <div class="bg-gray-50 rounded-lg p-3">
                            <div class="flex items-center mb-1">
                                <div class="w-6 h-6 rounded-full bg-gray-200 overflow-hidden mr-2">
                                    <img src="https://readdy.ai/api/search-image?query=professional%20portrait%20of%20a%20young%20Asian%20male%20student%2C%20casual%20attire%2C%20university%20campus%20background%2C%20natural%20lighting&width=100&height=100&seq=5&orientation=squarish" alt="User avatar" class="w-full h-full object-cover">
                                </div>
                                <p class="text-xs font-medium">Rahul P.</p>
                                <div class="flex items-center ml-auto">
                                    <i class="ri-star-fill text-yellow-400 text-xs"></i>
                                    <i class="ri-star-fill text-yellow-400 text-xs"></i>
                                    <i class="ri-star-fill text-yellow-400 text-xs"></i>
                                    <i class="ri-star-fill text-yellow-400 text-xs"></i>
                                    <i class="ri-star-fill text-gray-200 text-xs"></i>
                                </div>
                            </div>
                            <p class="text-xs text-gray-700">Good ride but was 5 minutes late. Otherwise very safe driving.</p>
                        </div>
                    </div>
                    
                    <!-- Action Buttons -->
                    <div class="flex space-x-2">
                        <button class="flex-1 py-2 flex items-center justify-center bg-primary text-white text-sm rounded-button">
                            <i class="ri-message-3-line mr-1"></i>Message
                        </button>
                        <button class="flex-1 py-2 flex items-center justify-center bg-gray-100 text-gray-700 text-sm rounded-button">
                            <i class="ri-share-forward-line mr-1"></i>Share Profile
                        </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <script>
            document.addEventListener('DOMContentLoaded', function () {
                // Get page elements
                const loginPage = document.getElementById('login-page');
                const mainApp = document.getElementById('main-app');
                const findRidePage = document.getElementById('find-ride-page');
                // MMU SSO Login handler
                window.handleMMULogin = function () {
                    const loginBtn = document.getElementById('mmu-login-btn');
                    const loginBtnText = document.getElementById('login-btn-text');
                    const loginSpinner = document.getElementById('login-spinner');
                    const loginError = document.getElementById('login-error');
                    // Disable button and show loading state
                    loginBtn.disabled = true;
                    loginBtnText.textContent = 'Signing in...';
                    loginSpinner.classList.remove('hidden');
                    loginError.classList.add('hidden');
                    // Simulate MMU SSO authentication
                    setTimeout(() => {
                        try {
                        // Redirect to MMU SSO service for authentication
                        // Actual implementation would redirect to the university's authentication service
                            // which ensures only current students, staff, or lecturers can register and login
                            // Since this is a demo, we'll simulate with success/fail results
                            
                            // Simulate successful login (80% success rate)
                            if (Math.random() > 0.2) {
                                // Save login state
                                localStorage.setItem('isLoggedIn', 'true');
                                // Smooth transition to main app
                                loginPage.style.opacity = '0';
                                loginPage.style.transition = 'opacity 0.3s ease';
                                setTimeout(() => {
                                    loginPage.classList.add('hidden');
                                    mainApp.classList.remove('hidden');
                                    findRidePage.classList.remove('hidden');
                                    mainApp.style.opacity = '0';
                                    mainApp.style.transition = 'opacity 0.3s ease';
                                    requestAnimationFrame(() => {
                                        mainApp.style.opacity = '1';
                                    });
                                }, 300);
                            } else {
                                // Simulate login failure
                                throw new Error('MMU SSO verification failed. Please ensure you have a valid university account.');
                            }
                        } catch (error) {
                            // Show error message
                            loginError.textContent = error.message;
                            loginError.classList.remove('hidden');
                            // Reset button state
                            loginBtn.disabled = false;
                            loginBtnText.textContent = 'Sign in with MMU';
                            loginSpinner.classList.add('hidden');
                        }
                    }, 1500);
                };
                // Check if user is already logged in
                const isLoggedIn = localStorage.getItem('isLoggedIn') === 'true';
                if (isLoggedIn) {
                    loginPage.classList.add('hidden');
                    mainApp.classList.remove('hidden');
                    findRidePage.classList.remove('hidden');
                } else {
                    loginPage.classList.remove('hidden');
                    mainApp.classList.add('hidden');
                }
                // Add styles for smooth transitions
                loginPage.style.transition = 'opacity 0.3s ease';
                mainApp.style.transition = 'opacity 0.3s ease';
                // Get other page elements
                const offerRidePage = document.getElementById('offer-ride-page');
                const rideDetailsPage = document.getElementById('ride-details-page');
                const parkingMapPage = document.getElementById('parking-map-page');
                const messagesPage = document.getElementById('messages-page');
                const chatPage = document.getElementById('chat-page');
                const profilePage = document.getElementById('profile-page');
                const safetyPage = document.getElementById('safety-page');
                const btnFindRide = document.getElementById('btn-find-ride');
                const btnOfferRide = document.getElementById('btn-offer-ride');
                const tabFind = document.getElementById('tab-find');
                const tabParking = document.getElementById('tab-parking');
                const tabMessages = document.getElementById('tab-messages');
                const tabProfile = document.getElementById('tab-profile');
                const backToFind = document.getElementById('back-to-find');
                const backToMessages = document.getElementById('back-to-messages');
                const backToProfile = document.getElementById('back-to-profile');
                const requestRideBtn = document.getElementById('request-ride-btn');
                const requestSuccessModal = document.getElementById('request-success-modal');
                const closeModal = document.getElementById('close-modal');

                // Filter modal elements
                const filterModal = document.getElementById('filter-modal');
                const openFilterBtn = document.getElementById('open-filter');
                const closeFilterBtn = document.getElementById('close-filter');

                // Driver Profile Modal
                const driverProfileModal = document.getElementById('driver-profile-modal');
                const closeDriverProfile = document.getElementById('close-driver-profile');
                
                // Passenger Profile Modal
                const passengerProfileModal = document.getElementById('passenger-profile-modal');
                const closePassengerProfile = document.getElementById('close-passenger-profile');
                
                // Function to open driver profile modal
                window.openDriverProfile = function(driverData) {
                    // Populate driver data
                    console.log('Opening driver profile with name:', driverData.name);
                    const profileImage = document.getElementById('driver-profile-image');
                    profileImage.src = driverData.image || "";
                    
                    // Handle avatar fallback for empty images
                    if (!driverData.image || driverData.image === "" || driverData.image.includes("undefined") || profileImage?.src!="") {
                        profileImage.style.display = 'none';
                        
                        // Find or create fallback element
                        let fallbackDiv = profileImage.parentElement.querySelector('.avatar-fallback');
                        if (!fallbackDiv) {
                            fallbackDiv = document.createElement('div');
                            fallbackDiv.className = 'avatar-fallback';
                            profileImage.parentElement.appendChild(fallbackDiv);
                        }
                        
                        console.log(driverData.name);
                        // Generate initials from name
                        const name = driverData.name || "Unknown Driver";
                        const initials = name.split(' ')
                            .filter(part => part.length > 0)
                            .map(part => part[0])
                            .slice(0, 2)
                            .join('')
                            .toUpperCase();
                        
                        fallbackDiv.textContent = initials;
                        fallbackDiv.style.display = 'flex';
                    } else {
                        profileImage.style.display = 'block';
                        // Hide fallback if it exists
                        const fallbackDiv = profileImage.parentElement.querySelector('.avatar-fallback');
                        if (fallbackDiv) {
                            fallbackDiv.style.display = 'none';
                        }
                    }
                    
                    document.getElementById('driver-profile-name').textContent = driverData.name;
                    document.getElementById('driver-profile-rating').textContent = driverData.rating;
                    document.getElementById('driver-profile-faculty').textContent = driverData.faculty || 'MMU Student';
                    document.getElementById('driver-profile-rides').textContent = driverData.rides || '100+';
                    document.getElementById('driver-profile-experience').textContent = driverData.experience || '6 mo';
                    document.getElementById('driver-profile-points').textContent = driverData.points || '250';
                    document.getElementById('driver-profile-car').textContent = driverData.car || 'Toyota Corolla';
                    document.getElementById('driver-profile-plate').textContent = driverData.plate || 'WVS 3291';
                    
                    // Show the modal
                    driverProfileModal.classList.remove('hidden');
                };
                
                // Close driver profile modal
                closeDriverProfile.addEventListener('click', function () {
                    driverProfileModal.classList.add('hidden');
                });
                
                // Close modal when clicking outside
                driverProfileModal.addEventListener('click', function (event) {
                    if (event.target === driverProfileModal) {
                        driverProfileModal.classList.add('hidden');
                    }
                });
                
                // Add click handlers to driver avatars and names for profile popups
                function setupDriverProfileClicks() {
                    // Attach click events to all driver avatars and names in ride cards
                    const rideCards = document.querySelectorAll('.bg-white.rounded-lg.shadow-sm.p-3.cursor-pointer');
                    
                    rideCards.forEach(card => {
                        const driverContainer = card.querySelector('.flex.items-center');
                        const driverAvatar = driverContainer?.querySelector('.avatar-container');
                        const driverInfo = driverContainer?.querySelector('div:not(.avatar-container)');
                        
                        if (driverAvatar && driverInfo) {
                            // Get driver info
                            // Fix selector to correctly get the name from the card
                            const nameElement = driverInfo.querySelector('h3.font-medium.truncate-text');
                            console.log('Name element found:', nameElement);
                            const name = nameElement?.textContent || 'Unknown Driver';
                            console.log('Driver name:', name);
                            const rating = driverInfo.querySelector('.text-xs.text-gray-500 span')?.textContent || '4.8';
                            const image = driverAvatar.querySelector('img')?.src || '';
                            const car = card.querySelector('.ri-car-line')?.parentElement?.nextElementSibling?.textContent?.trim() || 'Toyota Corolla';
                            

                            // Create handler function with driver data
                            const handleClick = function(e) {
                                e.stopPropagation(); // Prevent triggering the parent onclick
                                
                                openDriverProfile({
                                    name: name,
                                    rating: rating,
                                    image: image,
                                    car: car,
                                    faculty: 'MMU Computer Science',
                                    rides: Math.floor(Math.random() * 100) + 50,
                                    experience: Math.floor(Math.random() * 12) + 1 + ' mo',
                                    points: Math.floor(Math.random() * 200) + 150,
                                    plate: 'MMU ' + Math.floor(Math.random() * 9000 + 1000)
                                });
                            };
                            
                            // Add click events
                            driverAvatar.addEventListener('click', handleClick);
                            driverInfo.addEventListener('click', handleClick);
                        }
                    });
                }
                
                // Call setup function after initial load
                setupDriverProfileClicks();

                // Open filter modal
                openFilterBtn.addEventListener('click', function () {
                    filterModal.classList.remove('hidden');
                });

                // Close filter modal
                closeFilterBtn.addEventListener('click', function () {
                    filterModal.classList.add('hidden');
                });

                // 隐藏所有页面
                function hideAllPages() {
                    findRidePage.classList.add('hidden');
                    offerRidePage.classList.add('hidden');
                    rideDetailsPage.classList.add('hidden');
                    parkingMapPage.classList.add('hidden');
                    messagesPage.classList.add('hidden');
                    chatPage.classList.add('hidden');
                    profilePage.classList.add('hidden');
                    safetyPage.classList.add('hidden');
                    myVehiclesPage.classList.add('hidden');
                    
                    // Hide feedback details page if it exists
                    const feedbackDetailsPage = document.getElementById('feedback-details-page');
                    if (feedbackDetailsPage) {
                        feedbackDetailsPage.classList.add('hidden');
                        // Reset scroll position when hiding
                        feedbackDetailsPage.scrollTop = 0;
                    }
                }
                // 重置底部标签栏
                function resetTabBar() {
                    tabFind.classList.remove('text-primary');
                    tabFind.classList.add('text-gray-500');
                    tabParking.classList.remove('text-primary');
                    tabParking.classList.add('text-gray-500');
                    tabMessages.classList.remove('text-primary');
                    tabMessages.classList.add('text-gray-500');
                    tabProfile.classList.remove('text-primary');
                    tabProfile.classList.add('text-gray-500');
                }
                // 切换到寻找拼车页面
                btnFindRide.addEventListener('click', function () {
                    hideAllPages();
                    findRidePage.classList.remove('hidden');
                    btnFindRide.classList.add('bg-primary', 'text-white');
                    btnOfferRide.classList.remove('bg-primary', 'text-white');
                    btnOfferRide.classList.add('text-gray-600');
                });
                // 切换到提供拼车页面
                btnOfferRide.addEventListener('click', function () {
                    hideAllPages();
                    offerRidePage.classList.remove('hidden');
                    btnOfferRide.classList.add('bg-primary', 'text-white');
                    btnFindRide.classList.remove('bg-primary', 'text-white');
                    btnFindRide.classList.add('text-gray-600');
                });
                // 底部标签栏导航
                tabFind.addEventListener('click', function () {
                    hideAllPages();
                    findRidePage.classList.remove('hidden');
                    resetTabBar();
                    tabFind.classList.remove('text-gray-500');
                    tabFind.classList.add('text-primary');
                    btnFindRide.classList.add('bg-primary', 'text-white');
                    btnOfferRide.classList.remove('bg-primary', 'text-white');
                    btnOfferRide.classList.add('text-gray-600');
                });
                tabParking.addEventListener('click', function () {
                    hideAllPages();
                    parkingMapPage.classList.remove('hidden');
                    resetTabBar();
                    tabParking.classList.remove('text-gray-500');
                    tabParking.classList.add('text-primary');
                });
                tabMessages.addEventListener('click', function () {
                    hideAllPages();
                    messagesPage.classList.remove('hidden');
                    resetTabBar();
                    tabMessages.classList.remove('text-gray-500');
                    tabMessages.classList.add('text-primary');
                });
                tabProfile.addEventListener('click', function () {
                    hideAllPages();
                    profilePage.classList.remove('hidden');
                    resetTabBar();
                    tabProfile.classList.remove('text-gray-500');
                    tabProfile.classList.add('text-primary');
                });
                // 返回按钮
                backToFind.addEventListener('click', function () {
                    hideAllPages();
                    findRidePage.classList.remove('hidden');
                    resetTabBar();
                    tabFind.classList.remove('text-gray-500');
                    tabFind.classList.add('text-primary');
                });
                backToMessages.addEventListener('click', function () {
                    hideAllPages();
                    messagesPage.classList.remove('hidden');
                    resetTabBar();
                    tabMessages.classList.remove('text-gray-500');
                    tabMessages.classList.add('text-primary');
                });
                backToProfile.addEventListener('click', function () {
                    hideAllPages();
                    profilePage.classList.remove('hidden');
                    resetTabBar();
                    tabProfile.classList.remove('text-gray-500');
                    tabProfile.classList.add('text-primary');
                });
                // 拼车详情页面
                window.showRideDetails = function (id) {
                    hideAllPages();
                    rideDetailsPage.classList.remove('hidden');
                    
                    // Re-setup driver profile clicks after showing ride details
                    setTimeout(setupDriverProfileClicks, 100);
                };
                // 聊天页面
                window.showChatPage = function () {
                    hideAllPages();
                    chatPage.classList.remove('hidden');
                };
                // 请求拼车弹窗
                requestRideBtn.addEventListener('click', function () {
                    requestSuccessModal.classList.remove('hidden');
                });
                closeModal.addEventListener('click', function () {
                    requestSuccessModal.classList.add('hidden');
                });

                // SOS Button and Emergency Contacts
                const sosBtn = document.getElementById('sos-btn');
                const sosModal = document.getElementById('sos-modal');
                const cancelSos = document.getElementById('cancel-sos');
                const sendSosNow = document.getElementById('send-sos-now');
                const sosCountdown = document.getElementById('sos-countdown');
                const emergencyContactsModal = document.getElementById('emergency-contacts-modal');
                const closeEmergencyContacts = document.getElementById('close-emergency-contacts');
                const saveEmergencyContacts = document.getElementById('save-emergency-contacts');

                // Show SOS Modal when SOS button is clicked
                sosBtn.addEventListener('click', function () {
                    sosModal.classList.remove('hidden');
                    let count = 10;
                    const countdownInterval = setInterval(function () {
                        count--;
                        sosCountdown.textContent = count;
                        if (count <= 0) {
                            clearInterval(countdownInterval);
                            // Simulate sending alert
                            sosModal.classList.add('hidden');
                            alert('Emergency alert sent to your emergency contacts with your current location and ride details.');
                        }
                    }, 1000);

                    // Cancel SOS
                    cancelSos.addEventListener('click', function () {
                        clearInterval(countdownInterval);
                        sosModal.classList.add('hidden');
                    });

                    // Send SOS immediately
                    sendSosNow.addEventListener('click', function () {
                        clearInterval(countdownInterval);
                        sosModal.classList.add('hidden');
                        alert('Emergency alert sent to your emergency contacts with your current location and ride details.');
                    });
                });

                // Emergency contacts from safety page
                const emergencyContactsInSafety = document.querySelectorAll('.bg-gray-100 .text-primary');
                emergencyContactsInSafety.forEach(function (element) {
                    if (element.textContent.trim() === '+ Add more contacts') {
                        element.addEventListener('click', function () {
                            emergencyContactsModal.classList.remove('hidden');
                        });
                    }
                });

                // Close emergency contacts modal
                closeEmergencyContacts.addEventListener('click', function () {
                    emergencyContactsModal.classList.add('hidden');
                });

                // Save emergency contacts
                saveEmergencyContacts.addEventListener('click', function () {
                    emergencyContactsModal.classList.add('hidden');
                    alert('Emergency contacts saved successfully.');
                });

                // My Vehicles Page Navigation
                const myVehiclesPage = document.getElementById('my-vehicles-page');
                const gotoMyVehicles = document.getElementById('goto-my-vehicles');
                const backToProfileFromVehicles = document.getElementById('back-to-profile-from-vehicles');

                gotoMyVehicles.addEventListener('click', function () {
                    hideAllPages();
                    myVehiclesPage.classList.remove('hidden');
                });

                backToProfileFromVehicles.addEventListener('click', function () {
                    myVehiclesPage.classList.add('hidden');
                    profilePage.classList.remove('hidden');
                    resetTabBar();
                    tabProfile.classList.remove('text-gray-500');
                    tabProfile.classList.add('text-primary');
                });

                // Ensure My Vehicles page is hidden when navigating to other pages
                tabFind.addEventListener('click', function () {
                    myVehiclesPage.classList.add('hidden');
                });

                tabParking.addEventListener('click', function () {
                    myVehiclesPage.classList.add('hidden');
                });

                tabMessages.addEventListener('click', function () {
                    myVehiclesPage.classList.add('hidden');
                });

                tabProfile.addEventListener('click', function () {
                    myVehiclesPage.classList.add('hidden');
                });

                // Profile Navigation from Nav Bar
                const navProfileBtn = document.getElementById('nav-profile-btn');

                navProfileBtn.addEventListener('click', function () {
                    hideAllPages();
                    profilePage.classList.remove('hidden');
                    resetTabBar();
                    tabProfile.classList.remove('text-gray-500');
                    tabProfile.classList.add('text-primary');

                    // Make sure my vehicles page is hidden
                    myVehiclesPage.classList.add('hidden');
                });

                // Safety Center Navigation
                const gotoSafetyCenter = document.getElementById('goto-safety-center');

                gotoSafetyCenter.addEventListener('click', function () {
                    hideAllPages();
                    safetyPage.classList.remove('hidden');
                });

                // Hide vehicles page when navigating to safety center
                gotoSafetyCenter.addEventListener('click', function () {
                    myVehiclesPage.classList.add('hidden');
                });

                // Notifications Panel Toggle
                const notificationsPanel = document.getElementById('notifications-panel');
                const openNotifications = document.getElementById('open-notifications');
                const closeNotifications = document.getElementById('close-notifications');

                openNotifications.addEventListener('click', function () {
                    notificationsPanel.classList.remove('translate-x-full');
                });

                closeNotifications.addEventListener('click', function () {
                    notificationsPanel.classList.add('translate-x-full');
                });

                // Close notifications when clicking outside
                document.addEventListener('click', function (event) {
                    if (!notificationsPanel.contains(event.target) && !openNotifications.contains(event.target)) {
                        notificationsPanel.classList.add('translate-x-full');
                    }
                });

                // Rewards Modal
                const rewardsModal = document.getElementById('rewards-modal');
                const openRewards = document.getElementById('open-rewards');
                const closeRewards = document.getElementById('close-rewards');

                openRewards.addEventListener('click', function () {
                    rewardsModal.classList.remove('hidden');
                });

                closeRewards.addEventListener('click', function () {
                    rewardsModal.classList.add('hidden');
                });

                // Close rewards modal when clicking outside
                rewardsModal.addEventListener('click', function (event) {
                    if (event.target === rewardsModal) {
                        rewardsModal.classList.add('hidden');
                    }
                });

                // Rating & Feedback System
                const ratingModal = document.getElementById('rating-modal');
                const starButtons = document.querySelectorAll('.star-btn');
                const quickTags = document.querySelectorAll('.quick-tag');
                const skipRatingBtn = document.getElementById('skip-rating');
                const submitRatingBtn = document.getElementById('submit-rating');
                const feedbackText = document.getElementById('feedback-text');
                let currentRating = 0;

                // Open rating modal after a completed ride (this would be called after a ride is completed)
                function openRatingModal(userData) {
                    // In a real app, userData would be passed with user details
                    if (userData) {
                        document.getElementById('rated-user-name').textContent = userData.name;
                        document.getElementById('rated-user-role').textContent = userData.role;
                        if (userData.image) {
                            document.getElementById('rated-user-image').src = userData.image;
                        }
                        if (userData.tripId) {
                            // Store the tripId in the modal for reference when submitting
                            ratingModal.setAttribute('data-trip-id', userData.tripId);
                        }
                    }

                    // Reset the rating state
                    resetRating();

                    // Show the modal
                    ratingModal.classList.remove('hidden');
                }

                // Reset rating state
                function resetRating() {
                    currentRating = 0;
                    starButtons.forEach(btn => {
                        btn.classList.remove('bg-yellow-50', 'text-yellow-400');
                        btn.classList.add('bg-gray-100', 'text-gray-400');
                        btn.querySelector('i').classList.remove('ri-star-fill');
                        btn.querySelector('i').classList.add('ri-star-line');
                    });

                    quickTags.forEach(tag => {
                        tag.classList.remove('bg-primary', 'text-white');
                        tag.classList.add('bg-gray-100', 'text-gray-700');
                    });

                    feedbackText.value = '';
                }

                // Handle star rating click
                starButtons.forEach(button => {
                    button.addEventListener('click', function () {
                        const rating = parseInt(this.getAttribute('data-rating'));
                        currentRating = rating;

                        // Update all buttons based on the selected rating
                        starButtons.forEach(btn => {
                            const btnRating = parseInt(btn.getAttribute('data-rating'));
                            const icon = btn.querySelector('i');

                            if (btnRating <= rating) {
                                btn.classList.remove('bg-gray-100', 'text-gray-400');
                                btn.classList.add('bg-yellow-50', 'text-yellow-400');
                                icon.classList.remove('ri-star-line');
                                icon.classList.add('ri-star-fill');
                            } else {
                                btn.classList.remove('bg-yellow-50', 'text-yellow-400');
                                btn.classList.add('bg-gray-100', 'text-gray-400');
                                icon.classList.remove('ri-star-fill');
                                icon.classList.add('ri-star-line');
                            }
                        });
                    });
                });

                // Handle quick tag selection
                quickTags.forEach(tag => {
                    tag.addEventListener('click', function () {
                        this.classList.toggle('bg-primary');
                        this.classList.toggle('text-white');
                        this.classList.toggle('bg-gray-100');
                        this.classList.toggle('text-gray-700');
                    });
                });

                // Skip rating
                skipRatingBtn.addEventListener('click', function () {
                    ratingModal.classList.add('hidden');
                });

                // Submit rating
                submitRatingBtn.addEventListener('click', function () {
                    // Get selected tags
                    const selectedTags = [];
                    quickTags.forEach(tag => {
                        if (tag.classList.contains('bg-primary')) {
                            selectedTags.push(tag.textContent);
                        }
                    });

                    // Get text feedback
                    const feedback = feedbackText.value;

                    // In a real app, you would send this data to your backend
                    console.log({
                        rating: currentRating,
                        tags: selectedTags,
                        feedback: feedback
                    });

                    // Show thank you message or redirect
                    alert('Thank you for your feedback!');
                    ratingModal.classList.add('hidden');

                    // If this was after a real ride completion, update the UI to reflect the completed status
                    // For demo purposes, we'll show the modal when clicking certain buttons
                });

                // For demo purposes: open rating modal when clicking "Completed" in the trips section
                // Only handle elements that are not within our new trip-item structure
                document.querySelectorAll('.text-xs.text-gray-500:not(.text-xs.text-white)').forEach(element => {
                    if (element.textContent.trim() === 'Completed' && !element.closest('.trip-item')) {
                        element.addEventListener('click', function (e) {
                            // Prevent event bubbling for old structure
                            e.stopPropagation();
                            
                            // Find the user name from the parent elements
                            const tripElement = this.closest('.flex.items-center.justify-between');
                            if (tripElement) {
                                const nameElement = tripElement.querySelector('.font-medium');
                                const roleElement = tripElement.querySelector('.text-xs.text-gray-500');
                                if (nameElement && roleElement) {
                                    openRatingModal({
                                        name: nameElement.textContent,
                                        role: roleElement.textContent.includes('Driver') ? 'Driver' : 'Passenger',
                                        image: tripElement.querySelector('img')?.src || null
                                    });
                                }
                            } else {
                                openRatingModal({ name: "Nurul Aisha binti Abdullah", role: "Driver" });
                            }
                        });
                    }
                });

                // Implement trip item clicking for ratings and feedback
                const viewFeedbackModal = document.getElementById('view-feedback-modal');
                const closeFeedbackViewBtn = document.getElementById('close-feedback-view');
                const closeFeedbackBtn = document.getElementById('close-feedback-btn');
                
                // Handle trip items click events
                document.querySelectorAll('.trip-item').forEach(tripItem => {
                    tripItem.addEventListener('click', function() {
                        const tripId = this.getAttribute('data-trip-id');
                        const tripStatus = this.getAttribute('data-status');
                        const wasRated = this.getAttribute('data-rated') === 'true';
                        
                        // Find the route and date information
                        const routeElement = this.querySelector('.font-medium');
                        const dateElement = this.querySelector('.text-xs.text-gray-500');
                        const route = routeElement ? routeElement.textContent : '';
                        const dateInfo = dateElement ? dateElement.textContent : '';
                        
                        // Only handle completed trips
                        if (tripStatus === 'completed') {
                            if (wasRated) {
                                // Show feedback view for rated trips
                                showFeedbackView({
                                    tripId: tripId,
                                    route: route,
                                    dateInfo: dateInfo,
                                    rating: parseInt(this.getAttribute('data-rating') || '5'),
                                    feedback: this.getAttribute('data-feedback') || '',
                                    tags: ['Punctual', 'Friendly', 'Clean Vehicle'] // Example tags
                                });
                            } else {
                                // Show rating modal for unrated trips
                                // Find driver/passenger name for rating modal
                                const nameElement = this.querySelector('.font-medium');
                                const roleElement = this.querySelector('.text-xs.text-gray-500');
                                
                                openRatingModal({
                                    name: nameElement ? nameElement.textContent.split('→')[0].trim() : "User",
                                    role: roleElement && roleElement.textContent.includes('Driver') ? 'Driver' : 'Passenger',
                                    image: this.querySelector('img')?.src || null,
                                    tripId: tripId
                                });
                            }
                        }
                    });
                });
                
                // Function to show feedback view
                function showFeedbackView(data) {
                    // First ensure all other pages are hidden
                    hideAllPages();
                    
                    // Get and display the feedback details page with proper styles
                    const feedbackDetailsPage = document.getElementById('feedback-details-page');
                    if (feedbackDetailsPage) {
                        document.body.style.overflow = 'hidden'; // Prevent body scrolling
                        feedbackDetailsPage.classList.remove('hidden');
                        feedbackDetailsPage.style.display = 'block';
                        feedbackDetailsPage.style.zIndex = '999'; // Ensure it's above everything
                    }
                    
                    // Parse route into from and to locations
                    const routeParts = data.route.split('→');
                    const fromLocation = routeParts[0] ? routeParts[0].trim() : '';
                    const toLocation = routeParts[1] ? routeParts[1].trim() : '';
                    
                    // Update destination (showing only 'to' location based on screenshot)
                    document.getElementById('feedback-to').textContent = toLocation;
                    
                    // Extract time and role from dateInfo
                    const timePart = data.dateInfo.split('|')[0] ? data.dateInfo.split('|')[0].trim() : 'N/A';
                    const rolePart = data.dateInfo.split('|')[1] ? data.dateInfo.split('|')[1].trim() : 'N/A';
                    
                    document.getElementById('feedback-time').textContent = timePart;
                    document.getElementById('feedback-role').textContent = 'As ' + rolePart;
                    
                    // Update stars based on rating (using new spacing)
                    const starsContainer = document.getElementById('feedback-stars');
                    starsContainer.innerHTML = '';
                    
                    for (let i = 0; i < 5; i++) {
                        const starSpan = document.createElement('span');
                        starSpan.className = i < data.rating ? 'text-yellow-400 mr-0.5' : 'text-gray-300 mr-0.5';
                        
                        const starIcon = document.createElement('i');
                        starIcon.className = 'ri-star-fill';
                        
                        starSpan.appendChild(starIcon);
                        starsContainer.appendChild(starSpan);
                    }
                    
                    // Reset scroll position to top
                    feedbackDetailsPage.scrollTop = 0;
                }
                
                // Set up back button for feedback page
                const backFromFeedbackBtn = document.getElementById('back-from-feedback');
                const feedbackDetailsPage = document.getElementById('feedback-details-page');
                
                if (backFromFeedbackBtn) {
                    backFromFeedbackBtn.addEventListener('click', function() {
                        // Hide the feedback details page with proper style restoration
                        if (feedbackDetailsPage) {
                            feedbackDetailsPage.classList.add('hidden');
                            feedbackDetailsPage.style.display = 'none';
                            feedbackDetailsPage.style.zIndex = '50'; // Reset to original z-index
                            document.body.style.overflow = ''; // Restore body scrolling
                            
                            // Reset scroll position when closing
                            feedbackDetailsPage.scrollTop = 0;
                            
                            // Show profile page
                            profilePage.classList.remove('hidden');
                            resetTabBar();
                            tabProfile.classList.remove('text-gray-500');
                            tabProfile.classList.add('text-primary');
                        }
                    });
                }
                
                // Modify the submitRating function to update the UI after rating
                const originalSubmitRating = submitRatingBtn.onclick;
                submitRatingBtn.onclick = function() {
                    // Get the current trip being rated
                    const currentTripId = ratingModal.getAttribute('data-trip-id');
                    
                    // Get selected tags
                    const selectedTags = [];
                    quickTags.forEach(tag => {
                        if (tag.classList.contains('bg-primary')) {
                            selectedTags.push(tag.textContent);
                        }
                    });

                    // Get text feedback and rating
                    const feedback = feedbackText.value;
                    
                    // Call original function
                    if (originalSubmitRating) {
                        originalSubmitRating.call(this);
                    }
                    
                    // Update the UI to show the trip as rated
                    if (currentTripId) {
                        const tripElement = document.querySelector(`.trip-item[data-trip-id="${currentTripId}"]`);
                        if (tripElement) {
                            tripElement.setAttribute('data-rated', 'true');
                            tripElement.setAttribute('data-rating', currentRating.toString());
                            tripElement.setAttribute('data-feedback', feedback);
                            
                                                            // Update the badge
                                const badge = tripElement.querySelector('.feedback-badge');
                                if (badge) {
                                    badge.classList.remove('bg-yellow-100', 'text-yellow-600');
                                    badge.classList.add('bg-green-100', 'text-green-600');
                                    badge.innerHTML = '<i class="ri-check-line mr-1"></i><span class="text-xs font-medium">Rated</span>';
                                }
                        }
                    }
                    
                    // Hide rating modal
                    ratingModal.classList.add('hidden');
                };
                
                // FOR LEGACY SUPPORT: Connect existing completed trips to rating system
                document.querySelectorAll('.text-xs.text-gray-500:not(.text-xs.text-white)').forEach(element => {
                    if (element.textContent.trim() === 'Completed' && !element.closest('.trip-item')) {
                        element.addEventListener('click', function () {
                            // Find the user name from the parent elements
                            const tripElement = this.closest('.flex.items-center.justify-between');
                            if (tripElement) {
                                const nameElement = tripElement.querySelector('.font-medium');
                                const roleElement = tripElement.querySelector('.text-xs.text-gray-500');
                                if (nameElement && roleElement) {
                                    openRatingModal({
                                        name: nameElement.textContent,
                                        role: roleElement.textContent.includes('Driver') ? 'Driver' : 'Passenger',
                                        image: tripElement.querySelector('img')?.src || null
                                    });
                                }
                            } else {
                                openRatingModal({ name: "Nurul Aisha binti Abdullah", role: "Driver" });
                            }
                        });
                    }
                });

                // Connect the nav bar rating button
                const openRatingBtn = document.getElementById('open-rating-btn');
                if (openRatingBtn) {
                    openRatingBtn.addEventListener('click', function () {
                        // Show rating modal with most recent driver
                        openRatingModal({
                            name: "Tan Wei Ming",
                            role: "Driver",
                            image: "https://readdy.ai/api/search-image?query=professional%20portrait%20of%20a%20young%20Malaysian%20Chinese%20male%20student%20with%20glasses%2C%20smiling%2C%20casual%20attire%2C%20university%20campus%20background%2C%20natural%20lighting%2C%20friendly%20expression&width=100&height=100&seq=1&orientation=squarish"
                        });
                    });
                }
                
                // Handle avatar image fallbacks
                function handleAvatarFallbacks() {
                    // Convert all profile image containers to use the fallback system
                    const profileImages = document.querySelectorAll('img[src*="readdy.ai"]');
                    
                    profileImages.forEach(img => {
                        // Disable the readdy.ai image to force fallback
                        img.src = "";
                        img.style.display = 'none';
                        
                        // Get the parent container
                        const container = img.closest('.rounded-full');
                        if (!container) return;
                        
                        // Add avatar-container class if not already present
                        if (!container.classList.contains('avatar-container')) {
                            container.classList.add('avatar-container');
                        }
                        
                        // Find nearby name element to extract initials
                        let userName = '';
                        const nameElement = container.parentNode.querySelector('.font-medium, .truncate-text');
                        if (nameElement) {
                            userName = nameElement.textContent.trim();
                        }
                        
                        // Find or create fallback div
                        let fallbackDiv = container.querySelector('.avatar-fallback');
                        if (!fallbackDiv) {
                            fallbackDiv = document.createElement('div');
                            fallbackDiv.className = 'avatar-fallback';
                            container.appendChild(fallbackDiv);
                        }
                        
                        // Always show the fallback
                        fallbackDiv.style.display = 'flex';
                        
                        // Generate initials from user name
                        let initials = 'U';
                        
                        if (userName) {
                            // Handle different naming conventions (Malaysian context)
                            // For names with "bin"/"binti", use first name initial + bin/binti initial
                            if (userName.includes('bin ') || userName.includes('binti ')) {
                                const parts = userName.split(' ');
                                if (parts.length >= 3) {
                                    initials = parts[0].charAt(0) + parts[parts.length-1].charAt(0);
                                }
                            } 
                            // For names with "Dr." or titles, use first letter of each main name part
                            else if (userName.includes('Dr.')) {
                                const parts = userName.replace('Dr.', '').trim().split(' ');
                                if (parts.length >= 2) {
                                    initials = parts[0].charAt(0) + parts[parts.length-1].charAt(0);
                                }
                            }
                            // For Chinese names (typically 3 parts), use first and last character
                            else if (userName.split(' ').length === 3) {
                                const parts = userName.split(' ');
                                initials = parts[0].charAt(0) + parts[2].charAt(0);
                            }
                            // Default: first letter of first and last name
                            else {
                                const parts = userName.split(' ');
                                if (parts.length >= 2) {
                                    initials = parts[0].charAt(0) + parts[parts.length-1].charAt(0);
                                } else if (parts.length === 1) {
                                    initials = parts[0].charAt(0);
                                }
                            }
                        }
                        
                        fallbackDiv.textContent = initials.toUpperCase();
                    });
                }
                
                // Run on page load
                handleAvatarFallbacks();
                
                // Run after dynamic content is loaded
                document.addEventListener('DOMContentLoaded', handleAvatarFallbacks);

                // Ride Details Page (Default Hidden) 
                window.showRideDetails = function (id) {
                    hideAllPages();
                    rideDetailsPage.classList.remove('hidden');
                    
                    // Re-setup driver profile clicks after showing ride details
                    setTimeout(setupDriverProfileClicks, 100);
                };

                // 聊天页面
                window.showChatPage = function () {
                    hideAllPages();
                    chatPage.classList.remove('hidden');
                };

                // Function to open passenger profile modal
                window.openPassengerProfile = function(passengerData) {
                    console.log("Opening passenger profile with data:", passengerData); // Debug
                    
                    // Populate passenger data
                    const profileImage = document.getElementById('passenger-profile-image');
                    const fallbackDiv = document.querySelector('#passenger-profile-modal .avatar-fallback');
                    
                    // Handle avatar image display
                    if (passengerData.image && passengerData.image !== "" && !passengerData.image.includes("undefined") && profileImage?.src!=="") {
                        // Valid image URL exists
                        profileImage.src = passengerData.image;
                        profileImage.style.display = 'block';
                        fallbackDiv.style.display = 'none';
                        console.log("hi1");

                    } else {
                        // No valid image, use fallback with initials
                        profileImage.style.display = 'none';
                        console.log("hi");
                        
                        // Generate initials from name
                        const name = passengerData.name || "Passenger";
                        const initials = name.split(' ')
                            .filter(part => part.length > 0)
                            .map(part => part[0])
                            .slice(0, 2)
                            .join('')
                            .toUpperCase();
                        
                        fallbackDiv.textContent = initials;
                        fallbackDiv.style.display = 'flex';
                    }
                    
                    // Set the text content for all profile elements
                    document.getElementById('passenger-profile-name').textContent = passengerData.name || "Passenger";
                    document.getElementById('passenger-profile-rating').textContent = passengerData.rating || "4.7";
                    document.getElementById('passenger-profile-faculty').textContent = passengerData.faculty || 'MMU Student';
                    document.getElementById('passenger-profile-rides').textContent = passengerData.rides || '40+';
                    document.getElementById('passenger-profile-joined').textContent = passengerData.joined || '3 mo';
                    document.getElementById('passenger-profile-points').textContent = passengerData.points || '150';
                    
                    // Make sure the modal is visible and on top
                    const passengerProfileModal = document.getElementById('passenger-profile-modal');
                    passengerProfileModal.style.zIndex = '9999';
                    passengerProfileModal.classList.remove('hidden');
                };

                // Setup passenger profile click in ride details
                const viewPassengerProfile = document.getElementById('view-passenger-profile');
                if (viewPassengerProfile) {
                    viewPassengerProfile.addEventListener('click', function(e) {
                        e.stopPropagation(); // Prevent triggering the parent onclick
                        
                        // Get passenger info from the DOM elements
                        const passengerImg = this.querySelector('img');
                        const passengerName = this.querySelector('.font-medium').textContent;
                        const passengerFaculty = this.querySelector('.text-xs.text-gray-500').textContent;
                        const passengerRating = this.querySelector('.text-xs.text-gray-500 span').textContent;
                        
                        // The image path could be undefined or empty, so handle that
                        let imagePath = '';
                        if (passengerImg && passengerImg.src && !passengerImg.src.includes('undefined')) {
                            imagePath = passengerImg.src;
                        }
                        
                        // Create a complete passenger data object
                        const passengerData = {
                            name: passengerName,
                            faculty: passengerFaculty,
                            rating: passengerRating,
                            image: imagePath,
                            rides: Math.floor(Math.random() * 50) + 20,
                            joined: Math.floor(Math.random() * 10) + 1 + ' mo',
                            points: Math.floor(Math.random() * 100) + 100
                        };
                        
                        console.log("Passenger data for profile:", passengerData);
                        
                        // Make sure the passenger profile modal exists
                        const passengerProfileModal = document.getElementById('passenger-profile-modal');
                        if (!passengerProfileModal) {
                            console.error("Passenger profile modal not found!");
                            return;
                        }
                        
                        // Call the function to open the profile
                        openPassengerProfile(passengerData);
                    });
                }
                
                // Registration modal functionality
                const registrationModal = document.getElementById('registration-modal');
                const registerBtn = document.getElementById('register-btn');
                const closeRegistrationBtn = document.getElementById('close-registration');
                const registrationForm = document.getElementById('registration-form');
                const registrationError = document.getElementById('registration-error');
                const verificationSuccessModal = document.getElementById('verification-success-modal');
                const verificationPendingModal = document.getElementById('verification-pending-modal');
                const verificationSuccessBtn = document.getElementById('verification-success-btn');
                const verificationPendingBtn = document.getElementById('verification-pending-btn');
                
                // Open registration modal
                if (registerBtn) {
                    registerBtn.addEventListener('click', function(e) {
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // Make sure the modal exists and is properly configured
                        const registrationModal = document.getElementById('registration-modal');
                        if (registrationModal) {
                            // Ensure modal is visible on top
                            registrationModal.style.zIndex = '9999';
                            registrationModal.classList.remove('hidden');
                            
                            // Force a reflow to ensure visibility
                            void registrationModal.offsetWidth;
                            
                            console.log("Registration modal should be visible now");
                        } else {
                            console.error("Registration modal not found in DOM");
                        }
                    });
                }
                
                // Close registration modal
                if (closeRegistrationBtn) {
                    closeRegistrationBtn.addEventListener('click', function() {
                        registrationModal.classList.add('hidden');
                        registrationForm.reset();
                        registrationError.classList.add('hidden');
                    });
                }
                
                // Handle registration form submission
                if (registrationForm) {
                    registrationForm.addEventListener('submit', function(e) {
                        e.preventDefault();
                        
                        const mmuId = document.getElementById('mmu-id').value;
                        const mmuEmail = document.getElementById('mmu-email').value;
                        const password = document.getElementById('password').value;
                        const confirmPassword = document.getElementById('confirm-password').value;
                        const registerSubmitBtn = document.getElementById('register-submit-btn');
                        const registerBtnText = document.getElementById('register-btn-text');
                        const registerSpinner = document.getElementById('register-spinner');
                        
                        // Basic validation
                        if (password !== confirmPassword) {
                            registrationError.textContent = "Passwords do not match";
                            registrationError.classList.remove('hidden');
                            return;
                        }
                        
                        // Validate MMU email format
                        if (!mmuEmail.endsWith('@student.mmu.edu.my') && 
                            !mmuEmail.endsWith('@mmu.edu.my') && 
                            !mmuEmail.endsWith('@staff.mmu.edu.my')) {
                            registrationError.textContent = "Please use a valid MMU email address";
                            registrationError.classList.remove('hidden');
                            return;
                        }
                        
                        // Validate MMU ID format (typically numeric and 7-10 digits)
                        if (!/^\d{7,10}$/.test(mmuId)) {
                            registrationError.textContent = "Please enter a valid MMU ID (7-10 digits)";
                            registrationError.classList.remove('hidden');
                            return;
                        }
                        
                        // Show loading state
                        registerSubmitBtn.disabled = true;
                        registerBtnText.textContent = 'Verifying...';
                        registerSpinner.classList.remove('hidden');
                        registrationError.classList.add('hidden');
                        
                        // Simulate MMU SSO verification process
                        setTimeout(() => {
                            // In a real implementation, this would connect to the MMU SSO service
                            // to verify the student/staff credentials
                            
                            // Simulate verification (80% success rate)
                            if (Math.random() > 0.2) {
                                // Hide registration modal
                                registrationModal.classList.add('hidden');
                                
                                // Determine if instant verification or email verification
                                if (Math.random() > 0.5) {
                                    // Show success modal (instant verification)
                                    verificationSuccessModal.classList.remove('hidden');
                                } else {
                                    // Show pending verification modal (email verification)
                                    verificationPendingModal.classList.remove('hidden');
                                }
                                
                                // Reset form
                                registrationForm.reset();
                            } else {
                                // Show error
                                registrationError.textContent = "MMU verification failed. Please ensure your ID and email are correct and that you are a current MMU student or staff member.";
                                registrationError.classList.remove('hidden');
                            }
                            
                            // Reset button state
                            registerSubmitBtn.disabled = false;
                            registerBtnText.textContent = 'Register with MMU SSO';
                            registerSpinner.classList.add('hidden');
                        }, 2000);
                    });
                }
                
                // Handle verification success button
                if (verificationSuccessBtn) {
                    verificationSuccessBtn.addEventListener('click', function() {
                        verificationSuccessModal.classList.add('hidden');
                    });
                }
                
                // Handle verification pending button
                if (verificationPendingBtn) {
                    verificationPendingBtn.addEventListener('click', function() {
                        verificationPendingModal.classList.add('hidden');
                    });
                }

                // Close passenger profile modal
                closePassengerProfile.addEventListener('click', function () {
                    passengerProfileModal.classList.add('hidden');
                });
                
                // Close modal when clicking outside
                passengerProfileModal.addEventListener('click', function (event) {
                    if (event.target === passengerProfileModal) {
                        passengerProfileModal.classList.add('hidden');
                    }
                });
            });
        </script>
</body>

</html>